(()=>{var e={991:()=>{customElements.define("app-authentication-form",class extends HTMLElement{static get observedAttributes(){return["username"]}constructor(){super(),this._cache=void 0}connectedCallback(){this.#e.addEventListener("submit",(e=>{const t={detail:this.submit};e.preventDefault(),this.dispatchEvent(new CustomEvent("app-authentify",t))}))}attributeChangedCallback(e,t,r){this.#t.value=r||""}get#r(){if(!this._cache){const e=this.querySelector("form");this._cache={formElement:e,passwordController:e.password,userNameController:e.identity,errorArea:this.querySelector("*[data-id=error-feedback]")}}return this._cache}get#e(){return this.#r.formElement}get#t(){return this.#r.userNameController}get#n(){return this.#r.passwordController}get#s(){return this.#r.errorArea}submit=async e=>{this.#s.innerHTML="",this.#t.disabled=!0,this.#n.disabled=!0;try{const t={password:this.#n.value||"",userName:this.#t.value||""};await e(t)}catch(e){const t=e,{errorCode:r}=t;r&&r>=400&&(this.#s.textContent=t.errorMessage)}finally{this.#t.disabled=!1,this.#n.disabled=!1,this.#n.focus(),this.#n.select()}}})},980:()=>{customElements.define("app-calendar-mutation-form",class extends HTMLElement{static get observedAttributes(){return["preferred-date","preferred-time","preferred-description","preferred-details","preferred-is-day-off"]}constructor(){super(),this._cache=void 0,this._value={date:"",timeNumeric:"",timeRange:"",isDayOff:!1,description:"",details:""}}connectedCallback(){const{formController:e,dateController:t,timeRangeController:r,timeNumericController:n,isDayOffController:s,cancelController:i}=this.#r;e.addEventListener("submit",(e=>{e.preventDefault(),this.dispatchEvent(new CustomEvent("app-calendar-mutation-form-submit",{detail:this.submit}))}));for(const e of[t,r,n,s])e.addEventListener("change",(()=>{this.#i(),this.#a()}));i&&(i.addEventListener("change",(()=>{this.#o(),this.#a()})),i.checked=!1,i.disabled=!1),this.#c()}attributeChangedCallback(e,t,r){switch(e){case"preferred-date":this._value.date=r||"";break;case"preferred-time":this._value.timeRange=function(e){switch(e){case"fullday":case"morning":case"afternoon":return e;default:return""}}(r||""),this._value.timeNumeric=function(e){switch(e){case"fullday":case"morning":case"afternoon":return"";default:return e}}(r||"");break;case"preferred-description":this._value.description=r||"";break;case"preferred-details":this._value.details=r||"";break;case"preferred-is-day-off":this._value.isDayOff="yes"===r}this.#c()}#c(){const{dateController:e,timeRangeController:t,timeNumericController:r,isDayOffController:n,descriptionController:s,detailsController:i}=this.#r,a=this._value;n.checked=a.isDayOff,n.disabled=!1,a.isDayOff?(t.value="fullday",t.disabled=!0,r.value="",r.disabled=!0):(t.value=a.timeRange,t.disabled=!1,a.timeRange?(r.value="",r.disabled=!0,r.required=!1):(r.value=a.timeNumeric,r.disabled=!1,r.required=!0)),e.value=a.date,e.disabled=!1,s.value=a.description,s.disabled=!1,i.value=a.details,i.disabled=!1}#o(){if(this.#c(),this.#r.cancelController.checked){const{dateController:e,timeRangeController:t,timeNumericController:r,isDayOffController:n,descriptionController:s,detailsController:i}=this.#r,a=[e,r,t,n,s,i];for(const e of a)e.disabled=!0}}#i(){const{timeRangeController:e,timeNumericController:t,isDayOffController:r}=this.#r;r.checked?(e.value="fullday",e.disabled=!0):e.disabled=!1,e.value?(t.disabled=!0,t.value="",t.required=!1):(t.disabled=!1,t.required=!0)}#a(){const{dateController:e,timeRangeController:t,timeNumericController:r,isDayOffController:n,descriptionController:s,detailsController:i,cancelController:a}=this.#r;this.dispatchEvent(new CustomEvent("app-calendar-mutation-form-change",{detail:{date:e.value||void 0,time:t.value||r.value||void 0,description:s.value||void 0,details:i.value||void 0,isDayOff:n.checked,cancel:a&&a.checked}}))}get#r(){if(!this._cache){const e=this.querySelector("form");this._cache={formController:e,dateController:e.dateController,timeRangeController:e.timeRangeController,timeNumericController:e.timeNumericController,isDayOffController:e.isDayOffController,descriptionController:e.descriptionController,detailsController:e.detailsController,cancelController:e.cancelController}}return this._cache}submit=async e=>{const{dateController:t,timeRangeController:r,timeNumericController:n,descriptionController:s,detailsController:i,isDayOffController:a,cancelController:o}=this.#r;o&&o.checked?await e({cancel:!0}):await e({cancel:!1,isDayOff:a.checked,strDate:t.value||void 0,strTime:r.value||n.value||void 0,strDescription:s.value||"",strDetails:i.value||void 0})}})}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(()=>{"use strict";const e=/^20[0-9][0-9]$/,t=/^(0[1-9]|1[0-2])$/,n=/^([0-2][0-9]|3[0-1])$/,s=/^([0-1][0-9]|2[0-4])$/,i=/^[0-5][0-9]$/;function a(r){e:{if("string"!=typeof r)break e;const s=r.substring(0,4),i=r.substring(5,7),a=r.substring(8,10);if(s.match(e)&&i.match(t)&&a.match(n)){if("31"==a)switch(i){case"02":case"04":case"06":case"09":case"11":break e}else{if(a>="29"&&"02"==i)break e;if("29"==a&&"02"==i)t:switch(s[2]){case"0":case"2":case"4":case"6":case"8":switch(s[3]){case"0":case"4":case"8":break t;default:break e}default:switch(s[3]){case"2":case"6":break t;default:break e}}}return[s,i,a].join("-")}}return null}function o(e){e:if("string"==typeof e)switch(e){case"fullday":case"morning":case"afternoon":return e;default:{const t=e.substring(0,2),r=e.substring(3,5);if(!t.match(s))break e;if(!r.match(i))break e;return[t,r].join(":")}}return null}function c(e){const{date:t,time:r}=e;return`${t} ${r}`}function l(e){const t=e.substring(0,e.indexOf(" ")),r=e.substring(t.length+1);return{date:a(t),time:o(r)}}function u(){const e=new Date(Date.now()).toLocaleDateString("fr-BE"),[t,r,n]=e.split("/");return[n,r,t].join("-")}function d(e){return new Date(e).toISOString().substring(0,10)}function h(e){return Date.parse(e)}function f(e,t){if(t){const{dayShift:r,weekShift:n}=t;return n||!r?f(e,{dayShift:n?7*n+(r||0):1}):e+864e5*r}return f(e,{})}function m(e){return e.substring(8,10)}function p(e){return e.substring(5,7)}function g(e){switch(e){case"fullday":return"";case"afternoon":return"12";case"morning":return"00";default:return e}}function v(e,t,r){const{kind:n,userInitiator:s}=e;if("cursor_move"===n){const{cursor:t}=e;return s&&s===r?({patchCursor:e})=>e(parseInt(String(t))):void 0}{const i=a(e.strDate),c=o(e.strTime);if(i&&c){if("create"===n){const{strDescription:n,strDetails:a,isDayOff:o}=e;if(n){const e=s&&s!==r&&t||0;return({createEvent:t})=>t({date:i,time:c},{description:n,details:a||void 0,isDayOff:o||!1,hitTime:e})}return}return"cancel"===n?({deleteEvent:e})=>e({date:i,time:c}):void 0}return}}function b(e,t,r){if(e){const{version:n}=e;switch(n){case 1:return v(e,t,r);case 2:return function(e,t,r){const{toCancel:n,toCreate:s}=e,i=v(n,t,r),a=v(s,t,r);return i&&a?e=>{i(e),a(e)}:void 0}(e,t,r)}}}async function y(e){const{from:t,password:r,newEvent:n}=e,s="/send_event.php?from="+String(t),i=window.__csrfToken,a={Accept:"application/json"};let o;if(i&&(a["X-Csrf-Token"]=i),r&&(a.Authentication=btoa(r)),n?(a["Content-Type"]="application/json",o=await fetch(s,{method:"POST",headers:a,body:JSON.stringify(n)})):o=await fetch(s,{method:"GET",headers:a}),200!==o.status){const e=o.headers.get("X-Authentication-Delay");throw{errorCode:o.status,authenticationDelay:e,errorMessage:await o.json()}}return o}const w=new class{constructor(){this.view=new Map,this.newEvents=[],this.userCursor=0,this.isBusy=!1,this.lastUpdateTimestamp=0}#l(){if(!this.authentifiedUser.userName)throw{errorMessage:"Utilisateur non identifié",errorCode:403};return{view:this.view,newEvents:[...new Set(this.newEvents.map(c))].map((e=>{const{date:t,time:r}=l(e);return{strDate:t,strTime:r}}))}}#u(e){const{date:t,time:r}=e,n=this.view.get(t);n&&(n.delete(r),n.size||this.view.delete(t))}#d(e,t){const{date:r,time:n}=e,{description:s,details:i,hitTime:a,isDayOff:o}=t,c={description:s,details:i,isDayOff:o,unread:!!(a&&a>this.userCursor)};this.view.set(r,(this.view.get(r)||new Map).set(n,c)),c.unread&&this.newEvents.push({hitTime:a,time:n,date:r})}#h(e){const t=[];for(const r of this.newEvents){const{date:n,time:s}=r,i=new Map(this.view.get(n)).get(s);i&&(e(r)?i.unread=!1:t.push(r))}this.newEvents=t}#f(e){if(!isNaN(e)){const t=Math.max(this.userCursor,e);this.#h((({hitTime:e})=>(e||-1)<=t))}}async#m(e){const{password:t,newEvent:r}=e;try{if(this.isBusy)return!1;this.isBusy=!0;try{const e=await async function(e,t){function r(e){if(e){const r=window.localStorage.getItem("userName"),n=[];for(const t of e)if(t){const[e,s]=t;if(s){const t=b(e,s,r||void 0);t&&n.push(t)}}for(const e of n)e(t)}}const n=await y(e);return()=>async function(e){let t;for(let n=e;;){const e=parseInt(n.headers.get("x-next-page-time")||"0");if(!e||!isFinite(e)){r(await n.json());break}t=e,[n]=await Promise.all([y({from:e,password:void 0,newEvent:void 0}),n.json().then(r)])}return t}(n)}({password:t,newEvent:r,from:this.userCursor},{patchCursor:this.#f.bind(this),deleteEvent:this.#u.bind(this),createEvent:this.#d.bind(this)}),n=await e();this.userCursor=n||this.userCursor;const s=u();return this.#h((({date:e})=>(e||"")<s)),!0}finally{this.isBusy=!1}}catch(e){throw console.error(e),e}}get state(){return new Promise(((e,t)=>{const r=Date.now();(async()=>{if(!this._Backend__lastUpdateTimestamp||this._Backend__lastUpdateTimestamp<r-3e4)try{await this.#m({password:void 0,newEvent:void 0}),this._Backend__lastUpdateTimestamp=r}catch(e){t(e)}try{e(this.#l())}catch(e){t(e)}})()}))}get authentifiedUser(){return{userName:localStorage.getItem("userName")||void 0}}authentify=async e=>{const{password:t,userName:r}=e;return r?localStorage.setItem("userName",r):localStorage.removeItem("userName"),this.#m({password:t,newEvent:void 0})};createEvent=async e=>{const{time:t,date:r,strDescription:n,strDetails:s,isDayOff:i}=e,a={strTime:t,strDate:r,strDescription:n,strDetails:s,isDayOff:i,userInitiator:window.localStorage.getItem("userName")||void 0,kind:"create",version:1};return this.#m({newEvent:a,password:void 0})};cancelEvent=async e=>{const{date:t,time:r}=e,n={strDate:t,strTime:r,userInitiator:window.localStorage.getItem("userName")||void 0,version:1,kind:"cancel"};return this.#m({newEvent:n,password:void 0})};editEvent=async e=>{const{toCancel:t,toCreate:r}=e,n=window.localStorage.getItem("userName")||void 0,s={toCreate:(({date:e,time:t,strDescription:r,strDetails:s,isDayOff:i})=>({strTime:t,strDate:e,strDescription:r,strDetails:s,isDayOff:i,userInitiator:n,version:1,kind:"create"}))(r),toCancel:(({date:e,time:t})=>({strTime:t,strDate:e,version:1,kind:"cancel",userInitiator:n}))(t),version:2};return this.#m({newEvent:s,password:void 0})};markRead=async()=>{const e={userInitiator:window.localStorage.getItem("userName")||void 0,kind:"cursor_move",version:1,cursor:this.userCursor};return this.#m({newEvent:e,password:void 0})}},C=Object.freeze(new Map([["click","handleClick"],["submit","handleSubmit"],["change","handleChange"],["app-authentify","handleAppAuthentify"],["app-calendar-mutation-form-change","handleAppCalendarMutationFormChange"],["app-calendar-mutation-form-submit","handleAppCalendarMutationFormSubmit"]])),k=10,E="{",D="}",T="#",A="?",O=":",S="$",M="%",_="|",x='"',N="/",I="data-uuid",W=1e5,L=/\s\s+/g;function P(e){for(;;){const t="uuid"+Math.round(Math.random()*W);if(!e.has(t))return e.add(t),t}}function $(e,t,r){if(r)return $(e,new Set(t),!1);const n={children:[],symbol:"root"},s=t,i=[n];for(let t=0;t<e.length;){if(i.length>=k)throw"Template is too deep";const r=e.indexOf(E,t),n=i.pop();if(!n)throw"Exhausted ancestor chain";if(r>=0){if(t+1<r){const s=e.substring(t,r).replace(L," ");e:{if(" "===s){if("uuid"==n.symbol)break e;for(let e=i.length;--e>=0;)if("uuid"==i[e].symbol)break e}const e={symbol:"fragment",slice:s};n.children.push(e)}}const a=e.indexOf(D,r);if(-1==a){let t=0;for(const n of e.substring(0,r))"\n"==n&&(t+=1);throw`No closing symbol found for opening block; \n                        around line ${t}`}const o=e.substring(r+E.length+1,a).trim();switch(e[r+E.length]){case T:{const e=o?{symbol:"section",variable:o,children:[]}:{symbol:"uuid",elementUuid:P(s),children:[]};n.children.push(e),i.push(n),i.push(e)}break;case A:{const e={symbol:"if",variable:o,children:[]};n.children.push(e),i.push(n),i.push(e)}break;case O:{const e={symbol:"else",variable:o,children:[]};n.children.push(e),i.push(n),i.push(e)}break;case M:{const e={symbol:"event",variable:o};n.children.push(e),i.push(n)}break;case S:{const e={symbol:"textContent",variable:o};n.children.push(e),i.push(n)}break;case N:break;default:{const t=e.substring(r+E.length,a).trim(),s=t.indexOf(_);if(-1==s){let t=0;for(const n of e.substring(0,r))"\n"==n&&(t+=1);throw`No pipe delimiter found,\n                            though we reach the end of potential blocks;\n                            around line ${t}`}const o=t.substring(s+_.length,t.length).trim(),c=t.substring(0,s).trim();let l;l=c.startsWith(x)?{symbol:"hardAttribute",value:c.substring(1,c.length).trim(),pipe:o}:{symbol:"dynamicAttribute",variable:c,pipe:o},n.children.push(l),i.push(n)}}t=a+D.length}else{const r={symbol:"fragment",slice:e.substring(t,e.length).replace(L," ")};n.children.push(r),t=e.length}}return n}function q(e,t,r){return{kind:2,identifier:e,sideEffect:t,cancelEffect:r}}function R(e){return{kind:1,identifier:e}}function H(e,t){if(t){if(e){if(Object.hasOwn(e,t))return e[t];throw`Scope does not exhibit expected property ${t}`}throw`Provided scope is undefined (propery ${t}) - giving up`}throw"Provided property is undefined-- giving up"}function*z(e,t){switch(e.symbol){case"fragment":yield(r=e.slice,{kind:0,fragment:r});break;case"uuid":{const r=e.elementUuid;yield R(r);for(const n of e.children)for(const e of z(n,t))2==e.kind?yield q(r,e.sideEffect,e.cancelEffect):yield e}break;case"dynamicAttribute":{const r=e.pipe,n=H(t,e.variable)||"";if(!["string","boolean","number"].includes(typeof n))throw`Property ${e.variable} used as dynamic attribute must be a a primitive`;{const e=String(n);"class"==r?yield q("",(t=>t.classList.add(e)),(t=>t.classList.remove(e))):yield q("",(t=>t.setAttribute(r,e)),(e=>e.removeAttribute(r)))}}break;case"hardAttribute":{const t=e.pipe,r=e.value;"class"==t?yield q("",(e=>e.classList.add(r)),(e=>e.classList.remove(r))):yield q("",(e=>e.setAttribute(t,r)),(e=>e.removeAttribute(t)))}break;case"textContent":{const r=H(t,e.variable)||"";if(!["string","number"].includes(typeof r))throw`Property ${e.variable} used for textContent must be a string`;yield q("",(e=>e.textContent=String(r)),(e=>e.textContent=""))}break;case"event":{const r=e.variable,n=C.get(r),s=H(t,n);if(s){if("function"!=typeof s)throw`Property ${n} used as event handler must be a function`;yield q("",(e=>e.addEventListener(r,s)),(e=>e.removeEventListener(r,s)))}}break;case"if":if(H(t,e.variable))for(const r of e.children)yield*z(r,t);break;case"else":if(!H(t,e.variable))for(const r of e.children)yield*z(r,t);break;case"section":{const r=H(t,e.variable);if(r)if("function"==typeof r[Symbol.iterator]){let t=0;for(const n of r){for(const r of e.children)for(const e of z(r,n))if(0==e.kind)yield e;else{const r=`${e.identifier}_${t}`;2==e.kind?yield q(r,e.sideEffect,e.cancelEffect):1==e.kind&&(yield R(r))}t+=1}}else for(const t of e.children)yield*z(t,r)}break;default:throw`Unsupported plant symbol ${e.symbol}`}var r}function U(e){const t=$(e,new Set,!1);return function*(e,r,n){const s=new Map;{const i=[];for(const e of t.children)for(const t of z(e,r))if(0==t.kind)i.push(t.fragment);else{const e=`id${n}_${t.identifier}`;1==t.kind?i.push(` ${I}="${e}" `):(s.has(e)||s.set(e,[]),s.get(e).push({sideEffect:t.sideEffect,cancelEffect:t.cancelEffect}))}e.innerHTML=i.join("")}for(;;){for(const[t,r]of s){const n=e.querySelector(`*[${I}=${t}]`);for(const e of r)e.sideEffect(n),delete e.sideEffect}const i=yield;for(const[t,r]of s){const n=e.querySelector(`*[${I}=${t}]`);for(;;){const e=r.pop();if(!e)break;e.cancelEffect(n)}}if(!i)break;for(const e of t.children)for(const t of z(e,r))if(2==t.kind){const e=`id${n}_${t.identifier}`;s.has(e)||s.set(e,[]),s.get(e).push({sideEffect:t.sideEffect,cancelEffect:t.cancelEffect})}}}}const j={__compiledTemplates:new Map,getTemplate:function(e){const t=this.__compiledTemplates;if(!t.has(e)){const r=function(e){const t=window.DOMPurify;if(t){const r=U(e);return(e,n,s)=>{const i=document.createElement("div");r(i,n,s).next(),t.sanitize(i,{IN_PLACE:!0,CUSTOM_ELEMENT_HANDLING:{tagNameCheck:e=>!!e.match(/^app-/),attributeNameCheck:()=>!0,allowCustomizedBuiltInElements:!0}}),e.innerHTML="",e.appendChild(i)}}throw"DOMPurify library is required to use this method."}((0,window.getAppTemplate)(e));t.set(e,r)}return t.get(e)}};function B(e,t,r){const{numberOfWeeks:n,todayStrDate:s,focusStrDate:i}=e,a=function(e,t,r){const n=[];{const s=7*t;let i=function(e){const t=-(function(e){return new Date(e).getUTCDay()}(e)+6)%7;return t?f(e,{dayShift:t}):e}(h(e));for(let e=0;e<s;e++)n.push(d(i)),i=f(i);if(r){const e=p(n[n.length-1]);for(;;){const t=d(i);if(p(t)!=e)break;n.push(t),i=f(i)}}}const s=[];{let t=p(e);for(let r=0;r<n.length;r++){const i=n[r];if(i<e)p(i)!=t?s.push(void 0):s.push(i);else{const e=p(i);if(t!==e&&r%7)for(let e=0;e<7;e++)s.push(void 0);t=e,s.push(i)}}for(;s.length%7;)s.push(void 0)}const i=[];for(let e=0;e<s.length;){const t=s[e];0!=e&&t&&"01"!==m(t)||i.push([]),i[i.length-1].push(s.slice(e,e+=7))}return i}(i,Math.min(5,n),6==n);return{blocks:a.map((e=>({rows:e.map((e=>({cols:e.map((e=>function(e,t,r){const{strDate:n,todayStrDate:s,focusStrDate:i}=e;if(n){const e=new Map(t.get(n));let a=!1,o=!1,c=!1;for(const{unread:t,isDayOff:r}of e.values())o=!0,a=a||t,c=c||r;return{strDate:n,hasAppointments:o,hasNoUnread:!a,inFocusMonth:p(n)==p(i),isToday:n==s,isFocus:n==i,isDayOff:c,handleClick:()=>{r({url:"/appointments/day/",parameters:{strDate:n}})}}}return{strDate:void 0,hasAppointments:!1,hasNoUnread:!0,inFocusMonth:!0,isToday:!1,isFocus:!1,isDayOff:!1,handleClick:void 0}}({strDate:e,todayStrDate:s,focusStrDate:i},t,r)))}))),strDate:e[0].find(Boolean)})))}}function F({numberOfWeeks:e,firstWeekIncludes:t},r){return{handleChange:e=>{r({url:"/calendar-grid/",parameters:{firstWeekIncludes:t,numberOfWeeks:e.target.value}})},value:e}}function J({dateTime:e,numberOfWeeks:t},r){return{handleChange:e=>{e.target.value&&r({url:"/calendar-grid/",parameters:{firstWeekIncludes:d(e.target.value),numberOfWeeks:t}})},value:d(e)}}function Q({dateTime:e,numberOfWeeks:t},r){return{handleClick:()=>{r({url:"/calendar-grid/",parameters:{firstWeekIncludes:d(f(e,{weekShift:1})),numberOfWeeks:t}})}}}function G({dateTime:e,numberOfWeeks:t},r){return{handleClick:()=>{r({url:"/calendar-grid/",parameters:{firstWeekIncludes:d(f(e,{weekShift:-1})),numberOfWeeks:t}})}}}function X({newEvents:e},t){if(e.length)return{size:e.length,handleClick:()=>{t({url:"/appointments/unread/",parameters:{}})}}}customElements.define("app-long-french-date",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0,case:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,r){e:{if(r){const t=a(r);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;if(e){const t=function(e){switch(e){case"01":return"Janvier";case"02":return"Février";case"03":return"Mars";case"04":return"Avril";case"05":return"Mai";case"06":return"Juin";case"07":return"Juillet";case"08":return"Août";case"09":return"Septembre";case"10":return"Octobre";case"11":return"Novembre";case"12":return"Décembre";default:return""}}(p(e)),r=function(e){switch(e){case"01":return"1er";case"02":return"2";case"03":return"3";case"04":return"4";case"05":return"5";case"06":return"6";case"07":return"7";case"08":return"8";case"09":return"9";default:return e}}(m(e));"1er"==r?(this.innerHTML="1<sup>er</sup> ",this.appendChild(document.createTextNode(t))):this.textContent=`${r} ${t}`}else this.innerHTML=""}}),customElements.define("app-long-french-time",class extends HTMLElement{constructor(){super(),this.state={strtime:void 0,case:void 0}}static get observedAttributes(){return["strtime","case"]}attributeChangedCallback(e,t,r){e:{if(r){const t=o(r);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strtime,t=this.state.case;if(e){let r=function(e){switch(e){case"fullday":return"Toute la journée";case"afternoon":return"En après-midi";case"morning":return"Au matin";default:return`À ${e}`}}(e);"lowercase"==t&&(r=r.toLowerCase()),this.textContent=r}else this.innerHTML=""}}),customElements.define("app-french-month",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,r){e:{if(r){const t=a(r);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;if(e){const t=function(e){switch(e){case"01":return"Janvier";case"02":return"Février";case"03":return"Mars";case"04":return"Avril";case"05":return"Mai";case"06":return"Juin";case"07":return"Juillet";case"08":return"Août";case"09":return"Septembre";case"10":return"Octobre";case"11":return"Novembre";case"12":return"Décembre";default:return""}}(p(e));this.textContent=t}else this.innerHTML=""}}),customElements.define("app-day-two-digits",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,r){e:{if(r){const t=a(r);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;e?this.textContent=m(e):this.innerHTML=""}}),customElements.define("app-month-two-digits",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,r){e:{if(r){const t=a(r);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;e?this.textContent=p(e):this.innerHTML=""}}),customElements.define("app-year-four-digits",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,r){e:{if(r){const t=a(r);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;e?this.textContent=e.substring(0,4):this.innerHTML=""}}),r(991),r(980);const K="calendar-grid_main",Y="calendar-grid_rows";function V(){}function Z(e,t){const{strDate:r,strTime:n,eventData:s}=e,{description:i,details:a,isDayOff:o,unread:c}=s;return{strDate:r,strTime:n,strDescription:i,strDetails:a,isDayOff:o,markUnread:c,handleClick:()=>{t({url:"/calendar/mutate/modify",parameters:{preferredDate:r,preferredTime:n}})}}}function ee(e,t={sort:!1}){return t.sort?ee((Array.isArray(e)?e:[...e]).sort(((e,t)=>e.strDate==t.strDate?function(e,t){return e==t?0:g(e)<=g(t)?-1:1}(e.strTime,t.strTime):e.strDate<t.strDate?-1:1)),{sort:!1}):{appointments:e}}V.prototype={get _environment(){return this},paint:async function(e){const{numberOfWeeks:t,firstWeekIncludes:r}=e;if(!t){const e=sessionStorage.getItem("numberOfWeeks");if(e){const t=parseInt(e);if(isFinite(t))return await this.paint({numberOfWeeks:t,firstWeekIncludes:r})}return await this.paint({numberOfWeeks:5,firstWeekIncludes:r})}if(sessionStorage.setItem("numberOfWeeks",String(t)),!r){const e=sessionStorage.getItem("firstWeekIncludes");if(e){const r=a(e);if(r)return await this.paint({numberOfWeeks:t,firstWeekIncludes:r})}return await this.paint({numberOfWeeks:t,firstWeekIncludes:u()})}sessionStorage.setItem("firstWeekIncludes",r);const{view:n,newEvents:s}=await this.state;this.anchorElement.setAttribute("data-id",K);const i=h(r),o=u();var c;this.getTemplate(K)(this.anchorElement,{numberOfWeeksController:F({numberOfWeeks:t,firstWeekIncludes:r},this.navigateTo),firstDateIncludesController:J({dateTime:i,numberOfWeeks:t},this.navigateTo),previousWeekController:G({dateTime:i,numberOfWeeks:t},this.navigateTo),nextWeekController:Q({dateTime:i,numberOfWeeks:t},this.navigateTo),unreadNavigation:X({newEvents:s},this.navigateTo),searchNavigation:(c=this.navigateTo,{handleClick:()=>{c({url:"/appointments/search/",parameters:{}})}})},"0"),this.getTemplate(Y)(this.anchorElement.querySelector(`*[data-id=${Y}]`),B({numberOfWeeks:t,todayStrDate:o,focusStrDate:r},n,this.navigateTo),"1")}};class te{constructor(e,t){this.sourceIterable=e[Symbol.iterator](),this.f=t,this._current=void 0}next=()=>{for(let e=0;e<500;e++)if(this._current){const{done:e,value:t}=this._current.next();if(!e)return{done:!1,value:t};this._current=void 0}else{const{done:e,value:t}=this.sourceIterable.next();if(e)return{done:!0,value:void 0};if(this._current=this.f(t)[Symbol.iterator](),!this._current)throw"Undefined result of iterator"}throw"Acquiring next iterator failed after 500 iterations..."};[Symbol.iterator]=()=>this}function re(e){return t=>new te(t,e)}class ne{constructor(){this.functionStack=[]}map(e){return(new ne).#g(...this.functionStack,(t=>[e(t)]))}flatMap(e){const t=e;return(new ne).#g(...this.functionStack,t)}filter(e){return(new ne).#g(...this.functionStack,(t=>e(t)?[t]:[]))}debug(){return this.filter((e=>(console.log(e),!0)))}apply(e){let t=e;for(const e of this.functionStack)t=re(e)(t);return t}#g(...e){return this.functionStack=e,this}}const se="day-appointments_main";function ie(){}ie.prototype={paint:async function({strDate:e}){let{view:t}=await this.state;const r=a(e);if(r){this.anchorElement.setAttribute("data-id",se);let n=t.get(r)||new Map;this.getTemplate(se)(this.anchorElement,{strDate:e,menu:{back:{handleClick:()=>{this.navigateTo({url:"/calendar/grid",parameters:{}})}},create:{handleClick:()=>{this.navigateTo({url:"/calendar/mutate/create",parameters:{preferredDate:e}})}}},hasAppointments:n.size},"0");const s=this.anchorElement.querySelector("*[data-id=appointments_list]");if(s){const e=(new ne).map((([e,t])=>Z({strDate:r,strTime:e,eventData:t},this.navigateTo))).apply(n.entries());this.getTemplate("appointment_list")(s,ee(e,{sort:!0}),"1")}}}};const ae="unread-appointments_main";function oe(){}oe.prototype={paint:async function(){const{view:e,newEvents:t}=await this.state,r=!!t.length;var n;if(this.anchorElement.setAttribute("data-id",ae),this.getTemplate(ae)(this.anchorElement,{menu:{back:{handleClick:()=>{this.navigateTo({url:"/calendar/grid",parameters:{}})}},create:{handleClick:()=>{this.navigateTo({url:"/calendar/mutate/create",parameters:{preferredDate:u()}})}},markRead:r?{handleClick:(n=this,async function(){this.disabled=!0;try{await n.markRead(),history.back()}finally{this.disabled=!1}})}:void 0},hasAppointments:r},"0"),r){const r=(new ne).map((({strDate:t,strTime:r})=>Z({strDate:t,strTime:r,eventData:new Map(e.get(t)).get(r)},this.navigateTo))).apply(t);this.getTemplate("appointment_list")(this.anchorElement.querySelector("*[data-id=appointments_list]"),ee(r,{sorted:!0}),"1")}}};class ce{constructor(e){this.iterator=e,this.done=!1}next=()=>{const e=[];if(!this.done)for(let t=0;t<30;t++){const{done:t,value:r}=this.iterator.next();if(t)break;e.push(r)}return e.length?{value:e}:(this.done=!0,{done:!0,value:null})};[Symbol.iterator]=()=>this}function le(e){const t=new Set;for(const[r]of e.matchAll(/\b\w+\b/gi)){const e=ve(r);e&&t.add(e)}return t}function ue(e,t,r){return e.startsWith(t)?[e.slice(t.length),r]:void 0}function de(e,t,r){const n=t.length,s=t[n-1];if(e.startsWith(t))e:{if(e.length>n){const t=e[n];if(t==s||"aeiouyh".includes(t))break e}return[e.slice(n),r]}}function he(e,t){const r=[];let n=e;for(;n.length;)e:{for(const e of t){const t=e(n);if(t){const[e,s]=t;for(const e of s)r.push(e);n=e;break e}}const e=n[0];r.push(e),n=n.slice(1)}return r.join("")}const fe=[e=>e.startsWith("ch")?[e.slice(2),"C"]:e.startsWith("cc")?[e.slice(2),"x"]:e.startsWith("cq")?[e.slice(1),""]:e.startsWith("ci")||e.startsWith("ce")?[e.slice(1),"s"]:e.startsWith("c")?[e.slice(1),"k"]:void 0,e=>e.startsWith("gea")||e.startsWith("geo")?[e.slice(2),"j"]:e.startsWith("gi")||e.startsWith("gy")||e.startsWith("ge")?[e.slice(1),"j"]:e.startsWith("gui")||e.startsWith("guy")||e.startsWith("gue")?[e.slice(2),"g"]:void 0,e=>ue(e,"qu","k"),e=>ue(e,"q","k"),e=>ue(e,"ph","f"),e=>ue(e,"ille","Y"),e=>de(e,"on","O"),e=>de(e,"ain","I"),e=>de(e,"aim","I"),e=>ue(e,"ai","e"),e=>de(e,"an","A"),e=>de(e,"am","A"),e=>de(e,"ein","I"),e=>de(e,"eim","I"),e=>ue(e,"ei","e"),e=>de(e,"en","A"),e=>de(e,"em","A"),e=>de(e,"in","I"),e=>de(e,"im","I"),e=>ue(e,"au","o"),e=>ue(e,"eau","o"),e=>ue(e,"eu","E"),e=>ue(e,"ou","U"),e=>de(e,"un","I"),e=>de(e,"um","I"),e=>ue(e,"y","i")],me=[e=>ue(e,"tiO","siO"),e=>ue(e,"tiA","siA")],pe=[e=>{if(e.length>1&&e[0]===e[1])return[e.slice(1),""]},e=>ue(e,"h","")],ge=new Set(["au","aux","avec","ce","ces","dans","de","des","du","elle","en","et","eux","il","je","la","le","leur","lui","ma","mais","me","meme","mes","moi","mon","ne","nos","notre","nous","on","ou","par","pas","pour","qu","que","qui","sa","se","ses","son","sur","ta","te","tes","toi","ton","tu","un","une","vos","votre","vous","c","d","j","l","a","m","n","s","t","y","ete","etee","etees","etes","etant","suis","es","est","sommes","etes","sont","serai","seras","sera","serons","serez","seront","serais","serait","serions","seriez","seraient","etais","etait","etions","etiez","etaient","fus","fut","fumes","futes","furent","sois","soit","soyons","soyez","soient","fusse","fusses","fut","fussions","fussiez","fussent","ayant","eu","eue","eues","eus","ai","as","avons","avez","ont","aurai","auras","aura","aurons","aurez","auront","aurais","aurait","aurions","auriez","auraient","avais","avait","avions","aviez","avaient","eut","eumes","eutes","eurent","aie","aies","ait","ayons","ayez","aient","eusse","eusses","eut","eussions","eussiez","eussent","ceci","cela","cet","cette","ici","ils","les","leurs","quel","quels","quelle","quelles","sans","soi"]);function ve(e){const t=e.toLocaleLowerCase();if(!ge.has(t)){if("eau"==t)return t;{const e=t.replaceAll("ç","ss").replaceAll("ï","hi").replaceAll("ë","he").replaceAll("ü","hu").replaceAll("ö","ho").replaceAll("ä","ha").normalize("NFKD").replace(/[^\x20-\x7F]/g,"");if(e.length<=1)return;{const t=he(he(he(e,fe),me),pe);return t.length<=1?void 0:t}}}}function be(e,t,r,n){const{distance:s,penalization:i}=r,{x:a,y:o,upperBound:c}=n;if(s>c||i>=3)return 1/0;if(e.length){if(t.length){if(e[0]===t[0]){const r={distance:s,penalization:i-1};return be(e.slice(1),t.slice(1),r,n)}{const r=function(e,t){if(e==t)return 0;switch(e+t){case"oO":case"Oo":case"uO":case"Ou":case"aA":case"Aa":case"eA":case"Ae":case"eE":case"Ee":case"uE":case"Eu":case"iI":case"Ii":case"iy":case"yi":case"yI":case"Iy":return.3;case"vf":case"fv":case"bp":case"pb":case"td":case"dt":case"sz":case"zs":return.7;default:return 1}}(e[0],t[0]),a={distance:s+r,penalization:i+r>=.5?1:0};return Math.min(be(e.slice(1),t.slice(1),a,n),1.1*be(e,t.slice(1),a,n),1.1*be(e.slice(1),t,a,n))}}return s+e.length}return a.length>=4&&s<=1&&a[0]==o[0]?s:s+t.length}function ye(e,t,r){return e.length>t.length?ye(t,e,r):be(e,t,{distance:0,penalization:0},{x:e,y:t,upperBound:r})}class we{constructor(){this.documents=new Map,this.frequencies=new Map,this.documentCount=0}#v(e,t,r){let n=[];for(const s of t.keys())if(r.has(s)){const t=Math.log((1+this.documentCount)/(1+(this.frequencies.get(s)||0))),r=e.has(s)?1:.9;n.push({weight:r,idf:t})}let s=0,i=0,a=0;for(const{weight:e,idf:t}of n)s+=.9*e,e>i?(i=e,a=t):e==i&&(a=a<t?t:a);return{distance:s,idf:a}}#b(e){const t=new Map;for(const r of e)for(const e of this.frequencies.keys()){const n=ye(r,e,4);if(n<=Math.min(4,r.length/2,e.length)){const r=t.get(e)||NaN,s=isFinite(r)?Math.min(n,r):n;t.set(e,s)}}let r=-1/0;for(const e of t.values())r=Math.max(r,e);for(const[e,n]of t.entries())t.set(e,1+r-n);for(const n of e)t.set(n,1+r);return t}acceptAppointment=e=>{const{strDate:t,strTime:r,strDescription:n}=e,s=le(n),i=c({date:t,time:r});this.documents.set(i,s);for(const e of s){const t=this.frequencies.get(e)||0;this.frequencies.set(e,t+1)}this.documentCount+=1};cancelAppointment=e=>{const t=c({date:e.strDate,time:e.strTime});this.documents.delete(t)};search=e=>{const{maximalCount:t,searchQuery:r}=e,n=this,s=le(r),i=this.#b(s),a=(e,t)=>t.distance==e.distance?t.idf-e.idf:t.distance-e.distance;let o=[],c=0;for(const e of new ce(n.documents.entries())){for(const[t,r]of e){const{distance:e,idf:a}=n.#v(s,i,r);e>0&&e>=c&&o.push({distance:e,key:t,idf:a})}o.sort(a),o.length>t&&(o=o.slice(0,t),c=o[t-1].distance)}return o.map((({key:e})=>l(e)))}}const Ce="appointments-search_main";function ke(){}ke.prototype={paint:async function({defaultSearchQuery:e}){const{view:t}=await this.state,r=new we;for(const[e,n]of t)for(const[t,s]of n)r.acceptAppointment({strDate:e,strTime:t,strDescription:s.description});this.anchorElement.setAttribute("data-id",Ce);const n=this;this.getTemplate(Ce)(this.anchorElement,{handleSubmit:function(e){e.preventDefault();const s=this.querySelector("button"),i=this.search.value||"";if(i){s.disabled=!0;try{const e=r.search({maximalCount:10,searchQuery:i,past:!1}),s=(new ne).map((({date:e,time:r})=>Z({strDate:e,strTime:r,eventData:new Map(t.get(e)).get(r)},n.navigateTo))).apply(e);n.getTemplate("appointment_list")(n.anchorElement.querySelector("*[data-id=appointments_list]"),ee(s,{sorted:!0}),"1")}finally{s.disabled=!1}}},hasAppointments:!1,defaultSearchQuery:e,menu:{back:{handleClick:()=>{this.navigateTo({url:"/calendar/grid",parameters:{}})}}}},"0")}};const Ee="calendar-mutation-form";function De(){}function Te(){De.call(this)}function Ae(){De.call(this)}De.prototype={paint:async function({preferredDate:e,preferredTime:t}){let r,n,s,{view:i}=await this.state;if(this.anchorElement.setAttribute("data-id",Ee),r="",e&&t){let a=i.get(e),o=new Map(a).get(t);r=o.description,n=o.details,s=o.isDayOff}this.getTemplate(Ee)(this.anchorElement,{"preferred-date":e,"preferred-time":t,"preferred-description":r,"preferred-details":n,"preferred-is-day-off":s?"yes":"no",handleAppCalendarMutationFormSubmit:({detail:r})=>r(this.submitCalendarMutation({preferredDate:e,preferredTime:t})),handleAppCalendarMutationFormChange:({detail:r})=>{const{date:n,time:s}=r;this.showConflicts({strTime:s,strDate:n},{preferredDate:e,preferredTime:t},i)},...this.templateParameters},"0")},showConflicts:function({strTime:e,strDate:t},{preferredTime:r},n){let s=[];if(t&&e&&r!=e){const i=(n.get(t)||new Map).entries();s=[...(new ne).filter((([t])=>e!=r||t!=r)).filter((([t])=>{return(r=t)==(n=e)||"fullday"==r||"fullday"==n||"afternoon"==r&&n>="12:00"&&"morning"!=n||"afternoon"==n&&r>="12:00"&&"morning"!=n||"morning"==r&&n<"12:00"||"morning"==n&&r<"12:00";var r,n})).map((([e,r])=>Z({strDate:t,strTime:e,eventData:r}))).apply(i)]}const i=this.anchorElement.querySelector("*[data-id=conflicts_container]");s.length?(this.getTemplate("calendar-mutation-form_conflicts")(i,ee(s,{sorted:!0}),"1"),i.classList.remove("hidden")):(i.classList.add("hidden"),i.innerHTML="")},submitCalendarMutation:function({preferredDate:e,preferredTime:t}){return async r=>{const{cancel:n}=r;if(n)await this.cancelEvent({date:e,time:t});else{const{strDate:n,strTime:s,isDayOff:i,strDescription:a,strDetails:o}=r;!e||!t||e===n&&t===s?await this.createEvent({date:n,time:s,strDescription:a,strDetails:o,isDayOff:i}):await this.editEvent({toCreate:{date:n,time:s,strDescription:a,strDetails:o,isDayOff:i},toCancel:{date:e,time:t}})}this.navigateTo({url:"/calendar-grid",parameters:{}})}}},Te.prototype={templateParameters:{allowCancel:!1,pageTitle:"Créer un rendez-vous",submitText:"Créer"}},Object.setPrototypeOf(Te.prototype,De.prototype),Ae.prototype={templateParameters:{allowCancel:!0,pageTitle:"Modifier le rendez-vous",submitText:"Modifier"}},Object.setPrototypeOf(Ae.prototype,De.prototype);const Oe="authentication-pane";async function Se(e){await this.authentify(e),this.navigateTo({url:"/calendar-grid",parameters:{}})}function Me(){}function _e(){return document.getElementById("anchor-content")}Me.prototype={paint:async function(){this.anchorElement.setAttribute("data-id",Oe),this.getTemplate(Oe)(this.anchorElement,{username:this.authentifiedUser.userName,handleAppAuthentify:({detail:e})=>{e(Se.bind(this))}},"0")}};const xe="disallow403Reload";customElements.define("app-route-listener",class extends HTMLElement{constructor(){super(),this.currentRouteURL=void 0}connectedCallback(){window.addEventListener("popstate",(e=>this.#y({state:e.state}))),window.addEventListener("app-navigate",(({detail:e})=>this.#w(e))),(async()=>{await Ne,this.__URLS=new Map([["/calendar-grid/",new V],["/appointments/day/",new ie],["/appointments/unread/",new oe],["/appointments/search/",new ke],["/calendar/mutate/create",new Te],["/calendar/mutate/modify",new Ae],["/authentication/",new Me]]),this.#y({})})()}#y({state:e,hash:t}){if(e)this.#w(e);else{if(null==t){let e;try{e=atob(location.hash.substring(1))}catch(t){e=""}return this.#y({hash:e})}{let e=t.substring(0,t.indexOf("?")),r=new URLSearchParams(t.substring(e.length+1,t.length)),n=Object.fromEntries(r);this.#y({state:{url:e,parameters:n}})}}}#w({url:e,parameters:t}){e:{if(e){const r=this.__URLS.get(e);if(r){this.currentRouteURL=e,_e().innerHTML="",("/authentication/"==e?this.#C(r):this.#k(r)).paint(t).catch(console.error);break e}}this.#E({url:"/calendar-grid/",parameters:{}})}}#E({url:e,parameters:t}){dispatchEvent(new CustomEvent("app-navigate",{detail:{url:e,parameters:t}}))}#D(e){return async function(){try{const t=await e(...arguments);return window.sessionStorage.removeItem(xe),t}catch(e){let{errorCode:t,errorMessage:r}=e;throw 403!=t||window.sessionStorage.getItem(xe)||(window.sessionStorage.setItem(xe,!0),window.location.reload()),[401,403,429].includes(t)&&this.#E({url:"/authentication/",parameters:{errorMessage:r}}),e}}.bind(this)}#k(e){const t=this.#T(e),r=this,n={get state(){return r.#D((()=>w.state))()},get authentify(){return r.#D(w.authentify)},get createEvent(){return r.#D(w.createEvent)},get cancelEvent(){return r.#D(w.cancelEvent)},get editEvent(){return r.#D(w.editEvent)},get markRead(){return r.#D(w.markRead)}};return Object.setPrototypeOf(n,t),n}#C(e){const t=this.#T(e),r={get state(){throw"Property not available in Authentication process"},get authentify(){return w.authentify},get authentifiedUser(){return w.authentifiedUser},get createEvent(){throw"Property not available in Authentication process"},get cancelEvent(){throw"Property not available in Authentication process"},get editEvent(){throw"Property not available in Authentication process"},get markRead(){throw"Property not available in Authentication process"}};return Object.setPrototypeOf(r,t),r}#T(e){const t=this,r={navigateTo:function({url:e,parameters:r}){const n=history.state;{const t=new URLSearchParams;for(const[e,n]of Object.entries(r))t.append(e,n);const s=`${e}?${t.toString()}`,i=`#${btoa(s)}`,a={url:e,parameters:r};n&&n.url===a.url?history.replaceState(a,"",i):history.pushState(a,"",i)}return t.#E({url:e,parameters:r})},get anchorElement(){return _e()},getTemplate:function(e){return function(e){return j.getTemplate(e)}(e)}};return Object.setPrototypeOf(r,e),r}});const Ne=new Promise((e=>{window.addEventListener("load",e)}))})()})();