(()=>{var e={991:()=>{customElements.define("app-authentication-form",class extends HTMLElement{static get observedAttributes(){return["username"]}constructor(){super(),this._cache=void 0}connectedCallback(){this.#e.addEventListener("submit",(e=>{e.preventDefault(),this.dispatchEvent(new CustomEvent("app-authentify",{detail:this.submit}))}))}attributeChangedCallback(e,t,n){this.#t.value=n||""}get#n(){if(!this._cache){const e=this.querySelector("form");this._cache={formElement:e,passwordController:e.password,userNameController:e.identity,errorArea:this.querySelector("*[data-id=error-feedback]")}}return this._cache}get#e(){return this.#n.formElement}get#t(){return this.#n.userNameController}get#s(){return this.#n.passwordController}get#r(){return this.#n.errorArea}submit=async e=>{this.#r.innerHTML="",this.#t.disabled=!0,this.#s.disabled=!0;try{const t={password:this.#s.value||"",userName:this.#t.value||""};await e(t)}catch(e){const t=e,{errorCode:n}=t;n&&n>=400&&(this.#r.textContent=t.errorMessage)}finally{this.#t.disabled=!1,this.#s.disabled=!1,this.#s.focus(),this.#s.select()}}})},980:()=>{customElements.define("app-calendar-mutation-form",class extends HTMLElement{static get observedAttributes(){return["preferred-date","preferred-time","preferred-description","preferred-details","preferred-is-day-off"]}constructor(){super(),this._cache=void 0,this._value={date:"",timeNumeric:"",timeRange:"",isDayOff:!1,description:"",details:""}}connectedCallback(){const{formController:e,dateController:t,timeRangeController:n,timeNumericController:s,isDayOffController:r,cancelController:i}=this.#n;e.addEventListener("submit",(e=>{e.preventDefault(),this.dispatchEvent(new CustomEvent("app-calendar-mutation-form-submit",{detail:this.submit}))}));for(const e of[t,n,s,r])e.addEventListener("change",(()=>{this.#i(),this.#a()}));i&&(i.addEventListener("change",(()=>{this.#o(),this.#a()})),i.checked=!1,i.disabled=!1),this.#c()}attributeChangedCallback(e,t,n){switch(e){case"preferred-date":this._value.date=n||"";break;case"preferred-time":this._value.timeRange=function(e){switch(e){case"fullday":case"morning":case"afternoon":return e;default:return""}}(n||""),this._value.timeNumeric=function(e){switch(e){case"fullday":case"morning":case"afternoon":return"";default:return e}}(n||"");break;case"preferred-description":this._value.description=n||"";break;case"preferred-details":this._value.details=n||"";break;case"preferred-is-day-off":this._value.isDayOff="yes"===n}this.#c()}#c(){const{dateController:e,timeRangeController:t,timeNumericController:n,isDayOffController:s,descriptionController:r,detailsController:i}=this.#n,a=this._value;s.checked=a.isDayOff,s.disabled=!1,a.isDayOff?(t.value="fullday",t.disabled=!0,n.value="",n.disabled=!0):(t.value=a.timeRange,t.disabled=!1,a.timeRange?(n.value="",n.disabled=!0,n.required=!1):(n.value=a.timeNumeric,n.disabled=!1,n.required=!0)),e.value=a.date,e.disabled=!1,r.value=a.description,r.disabled=!1,i.value=a.details,i.disabled=!1}#o(){if(this.#c(),this.#n.cancelController.checked){const{dateController:e,timeRangeController:t,timeNumericController:n,isDayOffController:s,descriptionController:r,detailsController:i}=this.#n,a=[e,n,t,s,r,i];for(const e of a)e.disabled=!0}}#i(){const{timeRangeController:e,timeNumericController:t,isDayOffController:n}=this.#n;n.checked?(e.value="fullday",e.disabled=!0):e.disabled=!1,e.value?(t.disabled=!0,t.value="",t.required=!1):(t.disabled=!1,t.required=!0)}#a(){const{dateController:e,timeRangeController:t,timeNumericController:n,isDayOffController:s,descriptionController:r,detailsController:i,cancelController:a}=this.#n;this.dispatchEvent(new CustomEvent("app-calendar-mutation-form-change",{detail:{date:e.value||void 0,time:t.value||n.value||void 0,description:r.value||void 0,details:i.value||void 0,isDayOff:s.checked,cancel:a&&a.checked}}))}get#n(){if(!this._cache){const e=this.querySelector("form");this._cache={formController:e,dateController:e.dateController,timeRangeController:e.timeRangeController,timeNumericController:e.timeNumericController,isDayOffController:e.isDayOffController,descriptionController:e.descriptionController,detailsController:e.detailsController,cancelController:e.cancelController}}return this._cache}submit=async e=>{const{dateController:t,timeRangeController:n,timeNumericController:s,descriptionController:r,detailsController:i,isDayOffController:a,cancelController:o}=this.#n;o&&o.checked?await e({cancel:!0}):await e({cancel:!1,isDayOff:a.checked,strDate:t.value||void 0,strTime:n.value||s.value||void 0,strDescription:r.value||void 0,strDetails:i.value||void 0})}})}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}(()=>{"use strict";const e=/^20[0-9][0-9]$/,t=/^(0[1-9]|1[0-2])$/,s=/^([0-2][0-9]|3[0-1])$/,r=/^([0-1][0-9]|2[0-4])$/,i=/^[0-5][0-9]$/;function a(n){e:{const r=n.substring(0,4),i=n.substring(5,7),a=n.substring(8,10);if(r.match(e)&&i.match(t)&&a.match(s)){if("31"==a)switch(i){case"02":case"04":case"06":case"09":case"11":break e}else{if(a>="29"&&"02"==i)break e;if("29"==a&&"02"==i)t:switch(r[2]){case"0":case"2":case"4":case"6":case"8":switch(r[3]){case"0":case"4":case"8":break t;default:break e}default:switch(r[3]){case"2":case"6":break t;default:break e}}}return[r,i,a].join("-")}}return null}function o(){const e=new Date(Date.now()).toLocaleDateString("fr-BE"),[t,n,s]=e.split("/");return[s,n,t].join("-")}function c(e){return new Date(e).toISOString().substring(0,10)}function l(e){return Date.parse(e)}function u(e,t){if(t){const{dayShift:n,weekShift:s}=t;return s||!n?u(e,{dayShift:s?7*s+(n||0):1}):e+864e5*n}return u(e,{})}function d(e){return e.substring(8,10)}function h(e){return e.substring(5,7)}function f(e){switch(e){case"fullday":return"";case"afternoon":return"12";case"morning":return"00";default:return e}}function m(e,t){return e.strDate===t.strDate?function(e,t){return e==t?0:f(e)<=f(t)?-1:1}(e.strTime,t.strTime):e.strDate<=t.strDate?-1:1}function p(e,t,n){const{kind:s,userInitiator:r}=e;if("cursor_move"===s){const{cursor:t}=e;return r&&r===n?({patchCursor:e})=>e(parseInt(String(t))):void 0}{const{strDate:i,strTime:a}=e,o=Date.parse(i);if(isNaN(o)||!a)return;if("create"===s){const{strDescription:s,strDetails:o,isDayOff:c}=e;if(s){const e=r&&r!==n?t:0;return({createEvent:t})=>t([i,a],{description:s,details:o||void 0,isDayOff:c||!1,time:e})}return}return"cancel"===s?({deleteEvent:e})=>e([i,a]):void 0}}function g(e,t,n){if(e){const{version:s}=e;switch(s){case 1:return p(e,t,n);case 2:return function(e,t,n){const{toCancel:s,toCreate:r}=e,i=p(s,t,n),a=p(r,t,n);return i&&a?e=>{i(e),a(e)}:void 0}(e,t,n)}}}async function v(e){const{from:t,password:n,newEvent:s}=e,r="/send_event.php?from="+String(t),i=window.__csrfToken,a={Accept:"application/json"};let o;if(i&&(a["X-Csrf-Token"]=i),n&&(a.Authentication=btoa(n)),s?(a["Content-Type"]="application/json",o=await fetch(r,{method:"POST",headers:a,body:JSON.stringify(s)})):o=await fetch(r,{method:"GET",headers:a}),200!==o.status){const e=o.headers.get("X-Authentication-Delay");throw{errorCode:o.status,authenticationDelay:e,errorMessage:await o.json()}}return o}const b=new class{constructor(){this.view=new Map,this.newEvents=[],this.userCursor=0,this.isBusy=!1,this.lastUpdateTimestamp=0}#l(){if(!this.authentifiedUser.userName)throw{errorMessage:"Utilisateur non identifié",errorCode:403};return{view:this.view,newEvents:[...new Set([...this.newEvents].map((({strTime:e,strDate:t})=>`${t} ${e}`)))].map((e=>{const t=e.indexOf(" ");return{strDate:e.substring(0,t),strTime:e.substring(t+1)}}))}}#u(e){console.log("DELETE",e);const[t,n]=e,s=this.view.get(t);s&&(s.delete(n),s.size||this.view.delete(t))}#d(e,t){const[n,s]=e,{description:r,details:i,time:a,isDayOff:o}=t,c={description:r,details:i,isDayOff:o,unread:!!(a&&a>this.userCursor)};this.view.has(n)||this.view.set(n,new Map),this.view.get(n).set(s,c),c.unread&&this.newEvents.push({time:a,strDate:n,strTime:s})}#h(e){const t=[];for(const n of this.newEvents){const{strDate:s,strTime:r}=n,i=new Map(this.view.get(s)).get(r);i&&(e(n)?i.unread=!1:t.push(n))}this.newEvents=t}#f(e){if(!isNaN(e)){const t=Math.max(this.userCursor,e);this.#h((({time:e})=>(e||-1)<=t))}}async#m(e){const{password:t,newEvent:n}=e;try{if(this.isBusy)return!1;this.isBusy=!0;try{const e=await async function(e,t){function n(e){if(e){const n=window.localStorage.getItem("userName")||void 0,s=[];for(const t of e)if(t){const[e,r]=t;if(r){const t=g(e,r,n);t&&s.push(t)}}for(const e of s)e(t)}}const s=await v(e);return()=>async function(e){let t;for(let s=e;;){const e=parseInt(s.headers.get("x-next-page-time")||"0");if(!e||!isFinite(e)){n(await s.json());break}t=e,[s]=await Promise.all([v({from:e,password:void 0,newEvent:void 0}),s.json().then(n)])}return t}(s)}({password:t,newEvent:n,from:this.userCursor},{patchCursor:this.#f.bind(this),deleteEvent:this.#u.bind(this),createEvent:this.#d.bind(this)}),s=await e();this.userCursor=s||this.userCursor;const r=o();return this.#h((({strDate:e})=>(e||"")<r)),!0}finally{this.isBusy=!1}}catch(e){throw console.error(e),e}}get state(){return new Promise(((e,t)=>{const n=Date.now();(async()=>{if(!this._Backend__lastUpdateTimestamp||this._Backend__lastUpdateTimestamp<n-3e4)try{await this.#m({password:void 0,newEvent:void 0}),this._Backend__lastUpdateTimestamp=n}catch(e){t(e)}try{e(this.#l())}catch(e){t(e)}})()}))}get authentifiedUser(){return{userName:localStorage.getItem("userName")||void 0}}authentify=async e=>{const{password:t,userName:n}=e;return n?localStorage.setItem("userName",n):localStorage.removeItem("userName"),this.#m({password:t,newEvent:void 0})};createEvent=async e=>{const{strTime:t,strDate:n,strDescription:s,strDetails:r,isDayOff:i}=e,a={strTime:t,strDate:n,strDescription:s,strDetails:r,isDayOff:i,userInitiator:window.localStorage.getItem("userName")||void 0,kind:"create",version:1};return this.#m({newEvent:a,password:void 0})};cancelEvent=async e=>{const{strDate:t,strTime:n}=e,s={strDate:t,strTime:n,userInitiator:window.localStorage.getItem("userName")||void 0,version:1,kind:"cancel"};return this.#m({newEvent:s,password:void 0})};editEvent=async e=>{const{toCancel:t,toCreate:n}=e,s=window.localStorage.getItem("userName")||void 0,r={toCreate:(({strTime:e,strDate:t,strDescription:n,strDetails:r,isDayOff:i})=>({strTime:e,strDate:t,strDescription:n,strDetails:r,isDayOff:i,userInitiator:s,version:1,kind:"create"}))(n),toCancel:(({strTime:e,strDate:t})=>({strTime:e,strDate:t,version:1,kind:"cancel",userInitiator:s}))(t),version:2};return this.#m({newEvent:r,password:void 0})};markRead=async()=>{const e={userInitiator:window.localStorage.getItem("userName")||void 0,kind:"cursor_move",version:1,cursor:this.userCursor};return this.#m({newEvent:e,password:void 0})}};customElements.define("app-long-french-date",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0,case:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,n){e:{if(n){const t=a(n);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;if(e){const t=function(e){switch(e){case"01":return"Janvier";case"02":return"Février";case"03":return"Mars";case"04":return"Avril";case"05":return"Mai";case"06":return"Juin";case"07":return"Juillet";case"08":return"Août";case"09":return"Septembre";case"10":return"Octobre";case"11":return"Novembre";case"12":return"Décembre";default:return""}}(h(e)),n=function(e){switch(e){case"01":return"1er";case"02":return"2";case"03":return"3";case"04":return"4";case"05":return"5";case"06":return"6";case"07":return"7";case"08":return"8";case"09":return"9";default:return e}}(d(e));"1er"==n?(this.innerHTML="1<sup>er</sup> ",this.appendChild(document.createTextNode(t))):this.textContent=`${n} ${t}`}else this.innerHTML=""}}),customElements.define("app-long-french-time",class extends HTMLElement{constructor(){super(),this.state={strtime:void 0,case:void 0}}static get observedAttributes(){return["strtime","case"]}attributeChangedCallback(e,t,n){e:{if(n){const t=function(e){switch(e){case"fullday":case"morning":case"afternoon":return e;default:{const t=e.substring(0,2),n=e.substring(3,5);return t.match(r)&&n.match(i)?[t,n].join(":"):null}}}(n);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strtime,t=this.state.case;if(e){let n=function(e){switch(e){case"fullday":return"Toute la journée";case"afternoon":return"En après-midi";case"morning":return"Au matin";default:return`À ${e}`}}(e);"lowercase"==t&&(n=n.toLowerCase()),this.textContent=n}else this.innerHTML=""}}),customElements.define("app-french-month",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,n){e:{if(n){const t=a(n);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;if(e){const t=function(e){switch(e){case"01":return"Janvier";case"02":return"Février";case"03":return"Mars";case"04":return"Avril";case"05":return"Mai";case"06":return"Juin";case"07":return"Juillet";case"08":return"Août";case"09":return"Septembre";case"10":return"Octobre";case"11":return"Novembre";case"12":return"Décembre";default:return""}}(h(e));this.textContent=t}else this.innerHTML=""}}),customElements.define("app-day-two-digits",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,n){e:{if(n){const t=a(n);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;e?this.textContent=d(e):this.innerHTML=""}}),customElements.define("app-month-two-digits",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,n){e:{if(n){const t=a(n);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;e?this.textContent=h(e):this.innerHTML=""}}),customElements.define("app-year-four-digits",class extends HTMLElement{constructor(){super(),this.state={strdate:void 0}}static get observedAttributes(){return["strdate"]}attributeChangedCallback(e,t,n){e:{if(n){const t=a(n);if(t){this.state[e]=t;break e}}this.state[e]=void 0}this.#p()}#p(){const e=this.state.strdate;e?this.textContent=e.substring(0,4):this.innerHTML=""}}),n(991),n(980);const y=Object.freeze(new Map([["click","handleClick"],["submit","handleSubmit"],["change","handleChange"],["app-authentify","handleAppAuthentify"],["app-calendar-mutation-form-change","handleAppCalendarMutationFormChange"],["app-calendar-mutation-form-submit","handleAppCalendarMutationFormSubmit"]])),w=10,C="{",k="}",E="#",D="?",T=":",O="$",_="%",A="|",x='"',S="/",M="data-uuid",I=1e5,N=/\s\s+/g;function W(e){for(;;){const t="uuid"+Math.round(Math.random()*I);if(!e.has(t))return e.add(t),t}}function L(e,t,n){if(n)return L(e,new Set(t),!1);const s={children:[],symbol:"root"},r=t,i=[s];for(let t=0;t<e.length;){if(i.length>=w)throw"Template is too deep";const n=e.indexOf(C,t),s=i.pop();if(!s)throw"Exhausted ancestor chain";if(n>=0){if(t+1<n){const r=e.substring(t,n).replace(N," ");e:{if(" "===r){if("uuid"==s.symbol)break e;for(let e=i.length;--e>=0;)if("uuid"==i[e].symbol)break e}const e={symbol:"fragment",slice:r};s.children.push(e)}}const a=e.indexOf(k,n);if(-1==a){let t=0;for(const s of e.substring(0,n))"\n"==s&&(t+=1);throw`No closing symbol found for opening block; \n                        around line ${t}`}const o=e.substring(n+C.length+1,a).trim();switch(e[n+C.length]){case E:{const e=o?{symbol:"section",variable:o,children:[]}:{symbol:"uuid",elementUuid:W(r),children:[]};s.children.push(e),i.push(s),i.push(e)}break;case D:{const e={symbol:"if",variable:o,children:[]};s.children.push(e),i.push(s),i.push(e)}break;case T:{const e={symbol:"else",variable:o,children:[]};s.children.push(e),i.push(s),i.push(e)}break;case _:{const e={symbol:"event",variable:o};s.children.push(e),i.push(s)}break;case O:{const e={symbol:"textContent",variable:o};s.children.push(e),i.push(s)}break;case S:break;default:{const t=e.substring(n+C.length,a).trim(),r=t.indexOf(A);if(-1==r){let t=0;for(const s of e.substring(0,n))"\n"==s&&(t+=1);throw`No pipe delimiter found,\n                            though we reach the end of potential blocks;\n                            around line ${t}`}const o=t.substring(r+A.length,t.length).trim(),c=t.substring(0,r).trim();let l;l=c.startsWith(x)?{symbol:"hardAttribute",value:c.substring(1,c.length).trim(),pipe:o}:{symbol:"dynamicAttribute",variable:c,pipe:o},s.children.push(l),i.push(s)}}t=a+k.length}else{const n={symbol:"fragment",slice:e.substring(t,e.length).replace(N," ")};s.children.push(n),t=e.length}}return s}function H(e,t){switch(e.symbol){case"fragment":return new P({kind:0,fragment:e.slice});case"root":throw"Root must be handled differently,\n                as it returns string or side effects";case"uuid":return new R(e,t);case"textContent":{const n=e.variable;if(t&&Object.hasOwn(t,n)){const e=t[n];return null!=e?new P({kind:2,identifier:"",sideEffect:t=>t.textContent=e,cancelEffect:e=>e.textContent=""}):new $}throw`Scope is undefined or does not exhibit\n                    the expected handler for event ${n}`}case"hardAttribute":case"dynamicAttribute":{const n=e.pipe;let s;if("dynamicAttribute"==e.symbol){const n=e.variable;if(!t||!Object.hasOwn(t,n))throw`Scope is undefined or does not exhibit\n                        the expected variable ${n}`;s=t[n]}else s=e.value;return"class"===n?null!=s?new P({kind:2,identifier:"",sideEffect:e=>e.classList.add(s),cancelEffect:e=>e.classList.remove(s)}):new $:null!=s?new P({kind:2,identifier:"",sideEffect:e=>e.setAttribute(n,s),cancelEffect:e=>e.removeAttribute(n)}):new $}case"event":{const n=e.variable,s=y.get(n);if(!t||!s||!Object.hasOwn(t,s))throw`Scope is undefined or does not exhibit\n                    the expected handler for event ${n}`;const r=t[s];return null!=r?new P({kind:2,identifier:"",sideEffect:e=>e.addEventListener(n,r),cancelEffect:e=>e.removeEventListener(n,r)}):new $}case"section":case"if":case"else":if(!t||!Object.hasOwn(t,e.variable))throw`Scope is undefined or does not exhibit\n                    the expected block variable ${e.variable}`;{const n=t[e.variable];switch(e.symbol){case"section":if(n){const t=n[Symbol.iterator];return"function"==typeof t?new q(e,t.bind(n)()):new U(e,n)}return new $;case"if":return n?new U(e,t,"t"):new $;case"else":return n?new $:new U(e,t,"f")}}break;default:throw"Plant processor cannot be used in provided context"}}class ${next=()=>({done:!0,value:null})}class U{constructor(e,t,n){this.scope=t,this.prefix=n,this.children=e.children,this.readCursor=0,this.delegation=new $}next=()=>{for(;;){const{done:e,value:t}=this.delegation.next();if(!e){if(this.prefix&&(1==t.kind||2==t.kind)){const e=[this.prefix,t.identifier].filter(Boolean).join("_");return{value:{...t,identifier:e}}}return{value:t}}if(!(this.readCursor<this.children.length))break;{const e=this.children[this.readCursor];this.readCursor+=1,this.delegation=H(e,this.scope)}}return{done:!0,value:null}}}class R{constructor(e,t){this.elementUuid=e.elementUuid,this.identificationSent=!1,this.delegation=new U(e,t)}next=()=>{if(!this.identificationSent)return this.identificationSent=!0,{value:{kind:1,identifier:this.elementUuid}};for(;;){const{done:e,value:t}=this.delegation.next();if(e)return{done:e,value:null};if(2==t.kind)return{value:{kind:2,identifier:this.elementUuid,sideEffect:t.sideEffect,cancelEffect:t.cancelEffect}};throw`Unexpected value emission of kind ${t.kind}\n                            inside of identifier block ${this.elementUuid}`}}}class q{constructor(e,t){this.plant=e,this.generator=t,this.delegation=null,this.counter=-1}next=()=>{if(this.delegation){const{done:e,value:t}=this.delegation.next();if(!e)return{value:t}}for(;;){const e=this.generator.next();if(e.done)return{done:!0,value:null};{this.counter+=1,this.delegation=new U(this.plant,e.value,String(this.counter));const{done:t,value:n}=this.delegation.next();if(t)continue;return{value:n}}}}}class P{constructor(e){this.segment=e,this.done=!1}next=()=>this.done?{done:!0,value:null}:(this.done=!0,{value:this.segment})}class j{constructor(e,t){this.delegation=new U(e,t)}next=()=>{const{done:e,value:t}=this.delegation.next();if(e)return{done:e,value:void 0};if(0===t.kind)return{value:t.fragment};{const e=`id${t.identifier}`;return 1===t.kind?{value:` ${M}="${e}" `}:{value:{...t,identifier:e}}}};[Symbol.iterator]=()=>this}function z(e,t,n){const s=L(e,t||new Set,n||!1);return function*(e,t){const n=new Map;{const r=[];for(const e of new j(s,t))if("string"==typeof e)r.push(e);else{const{identifier:t,sideEffect:s,cancelEffect:r}=e;n.has(t)||n.set(t,[]),n.get(t).push({sideEffect:s,cancelEffect:r})}e.innerHTML=r.join("")}for(;;){for(const[t,s]of n){const n=e.querySelector(`*[${M}=${t}]`);for(const e of s)e.sideEffect(n),delete e.sideEffect}const t=yield;for(const[t,s]of n){const n=e.querySelector(`*[${M}=${t}]`);for(;;){const e=s.pop();if(!e)break;e.cancelEffect(n)}}if(!t)break;for(const e of new j(s,t))if("string"!=typeof e){const{identifier:t,sideEffect:s,cancelEffect:r}=e;n.has(t)||n.set(t,[]),n.get(t).push({sideEffect:s,cancelEffect:r})}}}}function B(e,t,n){const s=window.DOMPurify;if(s){const r=z(e,t,n);return(e,t)=>{const n=document.createElement("div");r(n,t).next(),s.sanitize(n,{IN_PLACE:!0,CUSTOM_ELEMENT_HANDLING:{tagNameCheck:e=>!!e.match(/^app-/),attributeNameCheck:()=>!0,allowCustomizedBuiltInElements:!0}}),e.innnerHTML="",e.appendChild(n)}}throw"DOMPurify library is required to use this method."}function F(e,t,n){const{numberOfWeeks:s,todayStrDate:r,focusStrDate:i}=e,a=function(e,t,n){const s=[];{const r=7*t;let i=function(e){const t=-(function(e){return new Date(e).getUTCDay()}(e)+6)%7;return t?u(e,{dayShift:t}):e}(l(e));for(let e=0;e<r;e++)s.push(c(i)),i=u(i);if(n){const e=h(s[s.length-1]);for(;;){const t=c(i);if(h(t)!=e)break;s.push(t),i=u(i)}}}const r=[];{let t=h(e);for(let n=0;n<s.length;n++){const i=s[n];if(i<e)h(i)!=t?r.push(void 0):r.push(i);else{const e=h(i);if(t!==e&&n%7)for(let e=0;e<7;e++)r.push(void 0);t=e,r.push(i)}}for(;r.length%7;)r.push(void 0)}const i=[];for(let e=0;e<r.length;){const t=r[e];0!=e&&t&&"01"!==d(t)||i.push([]),i[i.length-1].push(r.slice(e,e+=7))}return i}(i,Math.min(5,s),6==s);return{blocks:a.map((e=>({rows:e.map((e=>({cols:e.map((e=>function(e,t,n){const{strDate:s,todayStrDate:r,focusStrDate:i}=e;if(s){const e=new Map(t.get(s));let a=!1,o=!1,c=!1;for(const{unread:t,isDayOff:n}of e.values())o=!0,a=a||t,c=c||n;return{strDate:s,hasAppointments:o,hasNoUnread:!a,inFocusMonth:h(s)==h(i),isToday:s==r,isFocus:s==i,isDayOff:c,handleClick:()=>{n({url:"/appointments/day/",parameters:{strDate:s}})}}}return{strDate:void 0,hasAppointments:!1,hasNoUnread:!0,inFocusMonth:!0,isToday:!1,isFocus:!1,isDayOff:!1,handleClick:void 0}}({strDate:e,todayStrDate:r,focusStrDate:i},t,n)))}))),strDate:e[0].find(Boolean)})))}}function J({numberOfWeeks:e,firstWeekIncludes:t},n){return{handleChange:e=>{n({url:"/calendar-grid/",parameters:{firstWeekIncludes:t,numberOfWeeks:e.target.value}})},value:e}}function K({dateTime:e,numberOfWeeks:t},n){return{handleChange:e=>{e.target.value&&n({url:"/calendar-grid/",parameters:{firstWeekIncludes:c(e.target.value),numberOfWeeks:t}})},value:c(e)}}function Q({dateTime:e,numberOfWeeks:t},n){return{handleClick:()=>{n({url:"/calendar-grid/",parameters:{firstWeekIncludes:c(u(e,{weekShift:1})),numberOfWeeks:t}})}}}function G({dateTime:e,numberOfWeeks:t},n){return{handleClick:()=>{n({url:"/calendar-grid/",parameters:{firstWeekIncludes:c(u(e,{weekShift:-1})),numberOfWeeks:t}})}}}function X({newEvents:e},t){if(e.length)return{size:e.length,handleClick:()=>{t({url:"/appointments/unread/",parameters:{}})}}}const V="calendar-grid_main",Y="calendar-grid_rows";function Z(){const e=new Set,t=document.getElementById(V),n=document.getElementById(Y),s=B(t.innerText,e);this.__templates={main:s,rows:B(n.innerText,e,!0)}}Z.prototype={get _environment(){return this},paint:async function(e){const{numberOfWeeks:t,firstWeekIncludes:n}=e;if(!t){const e=sessionStorage.getItem("numberOfWeeks");if(e){const t=parseInt(e);if(isFinite(t))return await this.paint({numberOfWeeks:t,firstWeekIncludes:n})}return await this.paint({numberOfWeeks:5,firstWeekIncludes:n})}if(sessionStorage.setItem("numberOfWeeks",String(t)),!n){const e=sessionStorage.getItem("firstWeekIncludes");if(e){const n=a(e);if(n)return await this.paint({numberOfWeeks:t,firstWeekIncludes:n})}return await this.paint({numberOfWeeks:t,firstWeekIncludes:o()})}sessionStorage.setItem("firstWeekIncludes",n);const{view:s,newEvents:r}=await this.state;this.anchorElement.setAttribute("data-id",V);const i=l(n),c=o();var u;this.__templates.main(this.anchorElement,{numberOfWeeksController:J({numberOfWeeks:t,firstWeekIncludes:n},this.navigateTo),firstDateIncludesController:K({dateTime:i,numberOfWeeks:t},this.navigateTo),previousWeekController:G({dateTime:i,numberOfWeeks:t},this.navigateTo),nextWeekController:Q({dateTime:i,numberOfWeeks:t},this.navigateTo),unreadNavigation:X({newEvents:r},this.navigateTo),searchNavigation:(u=this.navigateTo,{handleClick:()=>{u({url:"/appointments/search/",parameters:{}})}})}),this.__templates.rows(this.anchorElement.querySelector(`*[data-id=${Y}]`),F({numberOfWeeks:t,todayStrDate:c,focusStrDate:n},s,this.navigateTo))}};const ee="appointments_list";function te(){this.__templates=B(document.getElementById(ee).innerText)}te.prototype={hydrate:async function(e,t,n){let s=function*(e,t,n){let s=e;if(n&&n.sort){let t=[...e];t=t.sort(m),s=t}for(const{strDate:e,strTime:n,strDescription:r,strDetails:i,isDayOff:a,markUnread:o}of s)yield{strDate:e,strTime:n,markUnread:o,strDescription:r,strDetails:i,isDayOff:a,handleClick:()=>{t({url:"/calendar/mutate/modify",parameters:{preferredDate:e,preferredTime:n}})}}}(t,e.navigateTo,n);this.__templates(e.anchorElement.querySelector(`*[data-id=${ee}]`),{appointments:s})},clear:function(e){e.anchorElement.querySelector(`*[data-id=${ee}]`).innerHTML=""}};const ne="day-appointments_main";function se(){this.__templates=B(document.getElementById(ne).innerText),this.__listHandler=new te}se.prototype={paint:async function({strDate:e}){let{view:t}=await this.state;this.anchorElement.setAttribute("data-id",ne);let n=t.get(e),s=n&&n.size;this.__templates(this.anchorElement,{strDate:e,menu:{back:{handleClick:()=>{this.navigateTo({url:"/calendar/grid",parameters:{}})}},create:{handleClick:()=>{this.navigateTo({url:"/calendar/mutate/create",parameters:{preferredDate:e}})}}},hasAppointments:s}),s&&this.__listHandler.hydrate(this,function*(e,t){for(let[n,s]of e)yield{strDate:t,strTime:n,strDescription:s.description,strDetails:s.details,markUnread:s.unread||!1,isDayOff:s.isDayOff||!1}}(n,e),{sort:!0})}};const re="unread-appointments_main";function ie(){this.__templates=B(document.getElementById(re).innerText),this.__listHandler=new te}ie.prototype={paint:async function(){let{view:e,newEvents:t}=await this.state;this.anchorElement.setAttribute("data-id",re);let n=!!t.length;var s;this.__templates(this.anchorElement,{menu:{back:{handleClick:()=>{this.navigateTo({url:"/calendar/grid",parameters:{}})}},create:{handleClick:()=>{this.navigateTo({url:"/calendar/mutate/create",parameters:{preferredDate:o()}})}},markRead:n?{handleClick:(s=this,async function(){this.disabled=!0;try{await s.markRead(),history.back()}finally{this.disabled=!1}})}:void 0},hasAppointments:n}),n&&this.__listHandler.hydrate(this,function*(e,t){console.log(e,t);for(let{strDate:n,strTime:s}of e){const e=t.get(n).get(s),r=e.description,i=e.details,a=e.isDayOff||!1;yield{strDate:n,strTime:s,strDescription:r,strDetails:i,isDayOff:a}}}(t,e),{sort:!0})}};class ae{constructor(e){this.iterator=e,this.done=!1}next=()=>{const e=[];if(!this.done)for(let t=0;t<30;t++){const{done:t,value:n}=this.iterator.next();if(t)break;e.push(n)}return e.length?{value:e}:(this.done=!0,{done:!0,value:null})};[Symbol.iterator]=()=>this}function oe(e){const t=new Set;for(const[n]of e.matchAll(/\b\w+\b/gi)){const e=pe(n);e&&t.add(e)}return t}function ce(e,t,n){return e.startsWith(t)?[e.slice(t.length),n]:void 0}function le(e,t,n){const s=t.length,r=t[s-1];if(e.startsWith(t))e:{if(e.length>s){const t=e[s];if(t==r||"aeiouyh".includes(t))break e}return[e.slice(s),n]}}function ue(e,t){const n=[];let s=e;for(;s.length;)e:{for(const e of t){const t=e(s);if(t){const[e,r]=t;for(const e of r)n.push(e);s=e;break e}}const e=s[0];n.push(e),s=s.slice(1)}return n.join("")}const de=[e=>e.startsWith("ch")?[e.slice(2),"C"]:e.startsWith("cc")?[e.slice(2),"x"]:e.startsWith("cq")?[e.slice(1),""]:e.startsWith("ci")||e.startsWith("ce")?[e.slice(1),"s"]:e.startsWith("c")?[e.slice(1),"k"]:void 0,e=>e.startsWith("gea")||e.startsWith("geo")?[e.slice(2),"j"]:e.startsWith("gi")||e.startsWith("gy")||e.startsWith("ge")?[e.slice(1),"j"]:e.startsWith("gui")||e.startsWith("guy")||e.startsWith("gue")?[e.slice(2),"g"]:void 0,e=>ce(e,"qu","k"),e=>ce(e,"q","k"),e=>ce(e,"ph","f"),e=>ce(e,"ille","Y"),e=>le(e,"on","O"),e=>le(e,"ain","I"),e=>le(e,"aim","I"),e=>ce(e,"ai","e"),e=>le(e,"an","A"),e=>le(e,"am","A"),e=>le(e,"ein","I"),e=>le(e,"eim","I"),e=>ce(e,"ei","e"),e=>le(e,"en","A"),e=>le(e,"em","A"),e=>le(e,"in","I"),e=>le(e,"im","I"),e=>ce(e,"au","o"),e=>ce(e,"eau","o"),e=>ce(e,"eu","E"),e=>ce(e,"ou","U"),e=>le(e,"un","I"),e=>le(e,"um","I"),e=>ce(e,"y","i")],he=[e=>ce(e,"tiO","siO"),e=>ce(e,"tiA","siA")],fe=[e=>{if(e.length>1&&e[0]===e[1])return[e.slice(1),""]},e=>ce(e,"h","")],me=new Set(["au","aux","avec","ce","ces","dans","de","des","du","elle","en","et","eux","il","je","la","le","leur","lui","ma","mais","me","meme","mes","moi","mon","ne","nos","notre","nous","on","ou","par","pas","pour","qu","que","qui","sa","se","ses","son","sur","ta","te","tes","toi","ton","tu","un","une","vos","votre","vous","c","d","j","l","a","m","n","s","t","y","ete","etee","etees","etes","etant","suis","es","est","sommes","etes","sont","serai","seras","sera","serons","serez","seront","serais","serait","serions","seriez","seraient","etais","etait","etions","etiez","etaient","fus","fut","fumes","futes","furent","sois","soit","soyons","soyez","soient","fusse","fusses","fut","fussions","fussiez","fussent","ayant","eu","eue","eues","eus","ai","as","avons","avez","ont","aurai","auras","aura","aurons","aurez","auront","aurais","aurait","aurions","auriez","auraient","avais","avait","avions","aviez","avaient","eut","eumes","eutes","eurent","aie","aies","ait","ayons","ayez","aient","eusse","eusses","eut","eussions","eussiez","eussent","ceci","cela","cet","cette","ici","ils","les","leurs","quel","quels","quelle","quelles","sans","soi"]);function pe(e){const t=e.toLocaleLowerCase();if(!me.has(t)){if("eau"==t)return t;{const e=t.replaceAll("ç","ss").replaceAll("ï","hi").replaceAll("ë","he").replaceAll("ü","hu").replaceAll("ö","ho").replaceAll("ä","ha").normalize("NFKD").replace(/[^\x20-\x7F]/g,"");if(e.length<=1)return;{const t=ue(ue(ue(e,de),he),fe);return t.length<=1?void 0:t}}}}function ge(e,t,n,s){const{distance:r,penalization:i}=n,{x:a,y:o,upperBound:c}=s;if(r>c||i>=3)return 1/0;if(e.length){if(t.length){if(e[0]===t[0]){const n={distance:r,penalization:i-1};return ge(e.slice(1),t.slice(1),n,s)}{const n=function(e,t){if(e==t)return 0;switch(e+t){case"oO":case"Oo":case"uO":case"Ou":case"aA":case"Aa":case"eA":case"Ae":case"eE":case"Ee":case"uE":case"Eu":case"iI":case"Ii":case"iy":case"yi":case"yI":case"Iy":return.3;case"vf":case"fv":case"bp":case"pb":case"td":case"dt":case"sz":case"zs":return.7;default:return 1}}(e[0],t[0]),a={distance:r+n,penalization:i+n>=.5?1:0};return Math.min(ge(e.slice(1),t.slice(1),a,s),1.1*ge(e,t.slice(1),a,s),1.1*ge(e.slice(1),t,a,s))}}return r+e.length}return a.length>=4&&r<=1&&a[0]==o[0]?r:r+t.length}function ve(e,t,n){return e.length>t.length?ve(t,e,n):ge(e,t,{distance:0,penalization:0},{x:e,y:t,upperBound:n})}class be{constructor(){this.documents=new Map,this.frequencies=new Map,this.documentCount=0}#g(e){const{strDate:t,strTime:n}=e;return`${t} ${n}`}#v(e,t,n){let s=[];for(const r of t.keys())if(n.has(r)){const t=Math.log((1+this.documentCount)/(1+(this.frequencies.get(r)||0))),n=e.has(r)?1:.9;s.push({weight:n,idf:t})}let r=0,i=0,a=0;for(const{weight:e,idf:t}of s)r+=.9*e,e>i?(i=e,a=t):e==i&&(a=a<t?t:a);return{distance:r,idf:a}}#b(e){const t=new Map;for(const n of e)for(const e of this.frequencies.keys()){const s=ve(n,e,4);if(s<=Math.min(4,n.length/2,e.length)){const n=t.get(e)||NaN,r=isFinite(n)?Math.min(s,n):s;t.set(e,r)}}let n=-1/0;for(const e of t.values())n=Math.max(n,e);for(const[e,s]of t.entries())t.set(e,1+n-s);for(const s of e)t.set(s,1+n);return t}acceptAppointment=e=>{const{strDate:t,strTime:n,strDescription:s}=e,r=oe(s),i=this.#g({strDate:t,strTime:n});this.documents.set(i,r);for(const e of r){const t=this.frequencies.get(e)||0;this.frequencies.set(e,t+1)}this.documentCount+=1};cancelAppointment=e=>{const t=this.#g(e);this.documents.delete(t)};search=e=>{const{maximalCount:t,searchQuery:n}=e,s=this,r=oe(n),i=this.#b(r),a=(e,t)=>t.distance==e.distance?t.idf-e.idf:t.distance-e.distance,c=o();let l=[],u=0;for(const e of new ae(s.documents.entries())){for(const[t,n]of e)if(!(t<c)){const{distance:e,idf:a}=s.#v(r,i,n);e>=u&&l.push({distance:e,key:t,idf:a})}l.sort(a),l.length>t&&(l=l.slice(0,t),u=l[0].distance)}return l}}const ye="appointments-search_main";function we(){this.__templates=B(document.getElementById(ye).innerText),this.__listHandler=new te}we.prototype={paint:async function({defaultSearchQuery:e}){let{view:t}=await this.state;this.anchorElement.setAttribute("data-id",ye);let n=new be;for(let[e,s]of t)for(let[t,r]of s)n.acceptAppointment({strDate:e,strTime:t,strDescription:r.description});var s;this.__templates(this.anchorElement,{handleSubmit:(s=this,function(e){e.preventDefault();let r=this.querySelector("button"),i=this.search.value||"";if(i){r.disabled=!0;try{let e=n.search({maximalCount:10,searchQuery:i,past:!1});s.__listHandler.clear(s),s.__listHandler.hydrate(s,function*(e,t){for(let{key:n}of e){let e=n.substring(0,n.indexOf(" ")),s=n.substring(e.length+1),{unread:r,description:i,details:a,isDayOff:o}=t.get(e).get(s);yield{strDate:e,strTime:s,strDescription:i,strDetails:a,markUnread:r,isDayOff:o||!1}}}(e,t))}finally{r.disabled=!1}}}),hasAppointments:!1,defaultSearchQuery:e,menu:{back:{handleClick:()=>{this.navigateTo({url:"/calendar/grid",parameters:{}})}}}})}};const Ce="calendar-mutation-form";function ke(){this.__template=B(document.getElementById(Ce).innerText),this.__listHandler=new te}function Ee(){ke.call(this)}function De(){ke.call(this)}ke.prototype={paint:async function({preferredDate:e,preferredTime:t}){let n,s,r,{view:i}=await this.state;if(this.anchorElement.setAttribute("data-id",Ce),n="",e&&t){let a=i.get(e),o=new Map(a).get(t);n=o.description,s=o.details,r=o.isDayOff}this.__template(this.anchorElement,{"preferred-date":e,"preferred-time":t,"preferred-description":n,"preferred-details":s,"preferred-is-day-off":r?"yes":"no",handleAppCalendarMutationFormSubmit:({detail:n})=>n(this.submitCalendarMutation({preferredDate:e,preferredTime:t})),handleAppCalendarMutationFormChange:({detail:n})=>{const{date:s,time:r}=n;this.showConflicts({strTime:r,strDate:s},{preferredDate:e,preferredTime:t},i)},...this.templateParameters})},showConflicts:function({strTime:e,strDate:t},{preferredDate:n,preferredTime:s},r){let i=[];t&&e&&(n==t&&s==e||(i=[...new Map(r.get(t)).entries()].filter((([t])=>{return(n=e)==(s=t)||"fullday"==n||"fullday"==s||"afternoon"==n&&s>="12:00"||"afternoon"==s&&n>="12:00"||"morning"==n&&s<"12:00"||"morning"==s&&n<"12:00";var n,s})).filter((([e])=>s!==e)).map((([e,n])=>({strTime:e,strDate:t,strDescription:n.description,strDetails:void 0,markUnread:n.unread})))));let a=this.anchorElement.querySelector("*[data-id=conflicts_container]");this.__listHandler.clear(this),i.length?(this.__listHandler.hydrate(this,i,{sort:!0}),a.classList.remove("hidden")):a.classList.add("hidden")},submitCalendarMutation:function({preferredDate:e,preferredTime:t}){return async n=>{const{cancel:s}=n;if(s)await this.cancelEvent({strDate:e,strTime:t});else{const{strDate:s,strTime:r,isDayOff:i,strDescription:a,strDetails:o}=n;!e||!t||e===s&&t===r?await this.createEvent({strDate:s,strTime:r,strDescription:a,strDetails:o,isDayOff:i}):await this.editEvent({toCreate:{strDate:s,strTime:r,strDescription:a,strDetails:o,isDayOff:i},toCancel:{strDate:e,strTime:t}})}this.navigateTo({url:"/calendar-grid",parameters:{}})}}},Ee.prototype={templateParameters:{allowCancel:!1,pageTitle:"Créer un rendez-vous",submitText:"Créer"}},Object.setPrototypeOf(Ee.prototype,ke.prototype),De.prototype={templateParameters:{allowCancel:!0,pageTitle:"Modifier le rendez-vous",submitText:"Modifier"}},Object.setPrototypeOf(De.prototype,ke.prototype);const Te="authentication-pane";function Oe(){const e=document.getElementById(Te);this.__templates={main:B(e.innerText)}}Oe.prototype={get _environment(){return this},paint:async function(){this.anchorElement.setAttribute("data-id",Te);const e=this.authentifiedUser.userName,t=async e=>{await this.authentify(e),this.navigateTo({url:"/calendar-grid",parameters:{}})};this.__templates.main(this.anchorElement,{handleAppAuthentify:({detail:e})=>e(t),username:e})}},customElements.define("app-route-listener",class extends HTMLElement{constructor(){super(),this.currentRouteURL=void 0}connectedCallback(){window.addEventListener("popstate",(e=>this.handleHistoryChange({state:e.state}))),window.addEventListener("app-navigate",(({detail:e})=>this.handleNavigation(e))),(async()=>{await _e,this.__URLS=new Map([["/calendar-grid/",new Z],["/appointments/day/",new se],["/appointments/unread/",new ie],["/appointments/search/",new we],["/calendar/mutate/create",new Ee],["/calendar/mutate/modify",new De],["/authentication/",new Oe]]),this.handleHistoryChange({})})()}handleHistoryChange({state:e,hash:t}){if(e)this.handleNavigation(e);else{if(null==t){let e;try{e=atob(location.hash.substring(1))}catch(t){e=""}return this.handleHistoryChange({hash:e})}{let e=t.substring(0,t.indexOf("?")),n=new URLSearchParams(t.substring(e.length+1,t.length)),s=Object.fromEntries(n);this.handleHistoryChange({state:{url:e,parameters:s}})}}}handleNavigation({url:e,parameters:t}){console.log("NAVIGATION",e,t);e:{if(e){const n=this.__URLS.get(e);if(n){this.currentRouteURL=e,this.clearPage(),("/authentication/"==e?this.patchAuthenticationPrototype(n):this.patchPrototype(n)).paint(t).catch(console.error);break e}}this.emitNavigation({url:"/calendar-grid/",parameters:{}})}}emitNavigation({url:e,parameters:t}){dispatchEvent(new CustomEvent("app-navigate",{detail:{url:e,parameters:t}}))}handleAuthenticationError(e){return async function(){try{return await e(...arguments)}catch(e){let{errorCode:t,errorMessage:n}=e;throw[401,403,429].includes(t)&&this.emitNavigation({url:"/authentication/",parameters:{errorMessage:n}}),e}}.bind(this)}patchPrototype(e){let t=this,n={get state(){return t.handleAuthenticationError((()=>b.state))()},get authentify(){return t.handleAuthenticationError(b.authentify)},get createEvent(){return t.handleAuthenticationError(b.createEvent)},get cancelEvent(){return t.handleAuthenticationError(b.cancelEvent)},get editEvent(){return t.handleAuthenticationError(b.editEvent)},get markRead(){return t.handleAuthenticationError(b.markRead)},get navigateTo(){return function({url:e,parameters:n}){const s=history.state;{const t=new URLSearchParams;for(const[e,s]of Object.entries(n))t.append(e,s);const r=`${e}?${t.toString()}`,i=`#${btoa(r)}`,a={url:e,parameters:n};s&&s.url===a.url?history.replaceState(a,"",i):history.pushState(a,"",i)}return t.emitNavigation({url:e,parameters:n})}},get anchorElement(){return document.getElementById("anchor-content")}};return Object.setPrototypeOf(n,e),n}clearPage(){document.getElementById("anchor-content").innerHTML=""}patchAuthenticationPrototype(e){let t=this,n={get state(){throw"Property not available in Authentication process"},get authentify(){return b.authentify},get authentifiedUser(){return b.authentifiedUser},get createEvent(){throw"Property not available in Authentication process"},get cancelEvent(){throw"Property not available in Authentication process"},get editEvent(){throw"Property not available in Authentication process"},get markRead(){throw"Property not available in Authentication process"},get navigateTo(){return function({url:e,parameters:n}){const s=history.state;{const t=new URLSearchParams;for(const[e,s]of Object.entries(n))t.append(e,s);const r=`${e}?${t.toString()}`,i=`#${btoa(r)}`,a={url:e,parameters:n};s&&s.url===a.url?history.replaceState(a,"",i):history.pushState(a,"",i)}return t.emitNavigation({url:e,parameters:n})}},get anchorElement(){return document.getElementById("anchor-content")}};return Object.setPrototypeOf(n,e),n}});const _e=new Promise((e=>{window.addEventListener("load",e)}))})()})();