(()=>{var t={534:()=>{customElements.define("app-form-balancer",class extends HTMLElement{constructor(){super()}connectedCallback(){if(this.isConnected){let t,e,s;{const s=this.getAttribute("data-source-bind"),n=s.substring(0,s.indexOf(":"));e=s.substring(1+n.length),t="^"==n?this.parentElement:this.parentElement.querySelector(`*[data-id=${n}]`)}{const t=this.getAttribute("data-sink-element");s="^"==t?this.parentElement:this.parentElement.querySelector(`*[data-id=${t}]`)}t.addEventListener(e,(t=>{let e;t.preventDefault(),e=t instanceof FormDataEvent?t.formData:t.detail.formData;for(const[t,n]of e.entries())s[t].value=String(n);s.dispatchEvent(new Event("submit"))}))}}})},877:()=>{customElements.define("app-form-value-to-data",class extends HTMLElement{constructor(){super()}connectedCallback(){if(this.isConnected){const t=t=>{const e=new FormDataEvent("formdata",{formData:t});this.dispatchEvent(e)},e=this.getAttribute("data-on")||"change",s=this.firstElementChild;if("INPUT"===s.tagName.toUpperCase())s.addEventListener(e,(function(){const e=new FormData;e.set(this.name,String(this.value)),t(e)}))}}})},141:()=>{customElements.define("app-hyperlink-trait",class extends HTMLFormElement{constructor(){super()}connectedCallback(){if(this.isConnected){this.style.display="none";const t=this.getAttribute("data-bind");if(t){const e=t.substring(0,t.indexOf(":")),s=t.substring(1+e.length);("^"==e?this.parentElement:this.parentElement.querySelector(`*[data-id=${e}]`)).addEventListener(s,(()=>this.dispatchEvent(new Event("submit"))))}this.addEventListener("submit",(t=>{t.preventDefault(),this.t()}))}}t(){const t=this.getAttribute("action"),e=new FormData(this),s={url:t,parameters:Object.fromEntries(e)};console.log(">>>",t,[...e],s),window.dispatchEvent(new CustomEvent("app-navigate",{detail:s}))}},{extends:"form"})},382:()=>{customElements.define("app-unsafe-text",class extends HTMLElement{constructor(){super()}connectedCallback(){const t="data-text";if(this.isConnected){let e="[Une erreur est survenue]";try{e=atob(this.getAttribute(t))}catch(t){console.error(t)}this.textContent=e,this.removeAttribute(t)}}})}},e={};function s(n){var a=e[n];if(void 0!==a)return a.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,s),i.exports}(()=>{"use strict";s(141),s(534),s(877),s(382);const t=new TextDecoder;class e{constructor(t){this.i=t,this.o=null}app_throw_error(e){const s=function(e){let s=0;for(const t of e)if(s+=1,!t)break;const n=e.subarray(0,s-1);return t.decode(n)}(this.i.subarray(e));throw new WebAssembly.RuntimeError(s)}app_set_heap_base(t){this.o=t,console.log("JS Runtime; heap_base =",this.o)}get imports(){return Object.freeze(Object.fromEntries(["app_throw_error","app_set_heap_base"].map((t=>[t,this[t].bind(this)]))))}}const n=/^20[0-9][0-9]$/,a=/^(0[1-9]|1[0-2])$/,i=/^([0-2][0-9]|3[0-1])$/,r=/^([0-1][0-9]|2[0-4])$/,o=/^[0-5][0-9]$/;function c(t){t:{if("string"!=typeof t)break t;const e=t.substring(0,4),s=t.substring(5,7),r=t.substring(8,10);if(e.match(n)&&(s.match(a)&&r.match(i))){if("31"==r)switch(s){case"02":case"04":case"06":case"09":case"11":break t}else{if(r>="29"&&"02"==s)break t;if("29"==r&&"02"==s)e:switch(e[2]){case"0":case"2":case"4":case"6":case"8":switch(e[3]){case"0":case"4":case"8":break e;default:break t}default:switch(e[3]){case"2":case"6":break e;default:break t}}}return[e,s,r].join("-")}}return null}function u(t){t:if("string"==typeof t)switch(t){case"fullday":case"morning":case"afternoon":return t;default:{const e=t.substring(0,2),s=t.substring(3,5);if(!e.match(r))break t;if(!s.match(o))break t;return[e,s].join(":")}}return null}function d(t){const{date:e,time:s}=t;return`${e} ${s}`}function h(){const t=new Date(Date.now()).toLocaleDateString("fr-BE"),[e,s,n]=t.split("/");return[n,s,e].join("-")}function l(t,e,s){const{kind:n,userInitiator:a}=t;if("cursor_move"===n){const{cursor:e}=t;return a&&a===s?({patchCursor:t})=>t(parseInt(String(e))):void 0}{const i=c(t.strDate),r=u(t.strTime);if(i&&r){if("create"===n){const{strDescription:n,strDetails:o,isDayOff:c}=t;if(n){const t=a&&a!==s&&e||0;return({createEvent:e})=>e({date:i,time:r},{description:n,details:o||void 0,isDayOff:c||!1,hitTime:t})}return}return"cancel"===n?({deleteEvent:t})=>t({date:i,time:r}):void 0}return}}function f(t,e,s){if(t){const{version:n}=t;switch(n){case 1:return l(t,e,s);case 2:return function(t,e,s){const{toCancel:n,toCreate:a}=t,i=l(n,e,s),r=l(a,e,s);return i&&r?t=>{i(t),r(t)}:void 0}(t,e,s)}}}async function w(t){const{from:e,password:s,newEvent:n}=t,a="/send_event.php?from="+String(e),i=window.__csrfToken,r={Accept:"application/json"};let o;if(i&&(r["X-Csrf-Token"]=i),s&&(r.Authentication=btoa(s)),n?(r["Content-Type"]="application/json",o=await fetch(a,{method:"POST",headers:r,body:JSON.stringify(n)})):o=await fetch(a,{method:"GET",headers:r}),200!==o.status){const t=o.headers.get("X-Authentication-Delay");throw{errorCode:o.status,authenticationDelay:t,errorMessage:await o.json()}}return o}async function m(t,e){function s(t){if(t){const s=window.localStorage.getItem("userName"),n=[];for(const e of t)if(e){const[t,a]=e;if(a){const e=f(t,a,s||void 0);e&&n.push(e)}}for(const t of n)t(e)}}const n=await w(t);return()=>async function(t){let e;for(let n=t;;){const t=parseInt(n.headers.get("x-next-page-time")||"0");if(!t||!isFinite(t)){s(await n.json());break}e=t,[n]=await Promise.all([w({from:t,password:void 0,newEvent:void 0}),n.json().then(s)])}return e}(n)}const p=new class{constructor(){this.view=new Map,this.newEvents=[],this.userCursor=0,this.isBusy=!1,this.lastUpdateTimestamp=0}#t(){if(!this.authentifiedUser.userName)throw{errorMessage:"Utilisateur non identifiÃ©",errorCode:403};return{view:this.view,newEvents:[...new Set(this.newEvents.map(d))].map((t=>{const{date:e,time:s}=function(t){const e=t.substring(0,t.indexOf(" ")),s=t.substring(e.length+1);return{date:c(e),time:u(s)}}(t);return{strDate:e,strTime:s}}))}}#e(t){const{date:e,time:s}=t,n=this.view.get(e);n&&(n.delete(s),n.size||this.view.delete(e))}#s(t,e){const{date:s,time:n}=t,{description:a,details:i,hitTime:r,isDayOff:o}=e,c={description:a,details:i,isDayOff:o,unread:!!(r&&r>this.userCursor)};this.view.set(s,(this.view.get(s)||new Map).set(n,c)),c.unread&&this.newEvents.push({hitTime:r,time:n,date:s})}#n(t){const e=[];for(const s of this.newEvents){const{date:n,time:a}=s,i=new Map(this.view.get(n)).get(a);i&&(t(s)?i.unread=!1:e.push(s))}this.newEvents=e}#a(t){if(!isNaN(t)){const e=Math.max(this.userCursor,t);this.#n((({hitTime:t})=>(t||-1)<=e))}}async#i(t){const{password:e,newEvent:s}=t;try{if(this.isBusy)return!1;this.isBusy=!0;try{const t=await m({password:e,newEvent:s,from:this.userCursor},{patchCursor:this.#a.bind(this),deleteEvent:this.#e.bind(this),createEvent:this.#s.bind(this)}),n=await t();this.userCursor=n||this.userCursor;const a=h();return this.#n((({date:t})=>(t||"")<a)),!0}finally{this.isBusy=!1}}catch(t){throw console.error(t),t}}get state(){return new Promise(((t,e)=>{const s=Date.now();(async()=>{if(!this.u||this.u<s-3e4)try{await this.#i({password:void 0,newEvent:void 0}),this.u=s}catch(t){e(t)}try{t(this.#t())}catch(t){e(t)}})()}))}get authentifiedUser(){return{userName:localStorage.getItem("userName")||void 0}}authentify=async t=>{const{password:e,userName:s}=t;return s?localStorage.setItem("userName",s):localStorage.removeItem("userName"),this.#i({password:e,newEvent:void 0})};createEvent=async t=>{const{time:e,date:s,strDescription:n,strDetails:a,isDayOff:i}=t,r={strTime:e,strDate:s,strDescription:n,strDetails:a,isDayOff:i,userInitiator:window.localStorage.getItem("userName")||void 0,kind:"create",version:1};return this.#i({newEvent:r,password:void 0})};cancelEvent=async t=>{const{date:e,time:s}=t,n={strDate:e,strTime:s,userInitiator:window.localStorage.getItem("userName")||void 0,version:1,kind:"cancel"};return this.#i({newEvent:n,password:void 0})};editEvent=async t=>{const{toCancel:e,toCreate:s}=t,n=window.localStorage.getItem("userName")||void 0,a={toCreate:(({date:t,time:e,strDescription:s,strDetails:a,isDayOff:i})=>({strTime:e,strDate:t,strDescription:s,strDetails:a,isDayOff:i,userInitiator:n,version:1,kind:"create"}))(s),toCancel:(({date:t,time:e})=>({strTime:e,strDate:t,version:1,kind:"cancel",userInitiator:n}))(e),version:2};return this.#i({newEvent:a,password:void 0})};markRead=async()=>{const t={userInitiator:window.localStorage.getItem("userName")||void 0,kind:"cursor_move",version:1,cursor:this.userCursor};return this.#i({newEvent:t,password:void 0})}};function v({state:t,hash:e}){if(!t){if(null==e){let t="";try{t=atob(location.hash.substring(1))}catch(t){console.warn(t)}return v({hash:t})}{const t=e.substring(0,e.indexOf("?"));return v({state:{url:t,parameters:Object.fromEntries(new URLSearchParams(e.substring(t.length+1,e.length)))}})}}window.dispatchEvent(new CustomEvent("app-navigate",{detail:t}))}window.__backend__=p,window.addEventListener("popstate",(t=>{v({state:t.state})}));const y={h:function({url:t,parameters:e}){if("calendar"==t){let{focus_date:t,weeks_count:s}=e;const n=h();return s?window.sessionStorage.setItem("weeks_count",s):s=window.sessionStorage.getItem("weeks_count")||5,t?window.sessionStorage.setItem("focus_date",t):t=window.sessionStorage.getItem("focus_date")||n,{focus_date:t,today_date:n,weeks_count:s}}return e},l:async function({url:t,parameters:e}){const s=this.h({url:t,parameters:e});try{!function({url:t,parameters:e}){const s=history.state,n=new URLSearchParams;for(const[t,s]of Object.entries(e))n.append(t,s);const a=`${t}?${n.toString()}`,i=`#${btoa(a)}`,r={url:t,parameters:e};s&&s.url===r.url?history.replaceState(r,"",i):history.pushState(r,"",i)}({url:t,parameters:s}),await this.m(function*({url:t,parameters:e}){yield`GET ${t}`;for(const[t,s]of Object.entries(e))yield`${t}:${s}`}({url:t,parameters:s}))}catch(t){console.error(t)}},m:void 0};window.addEventListener("load",(async()=>{const t=Object.setPrototypeOf({},y);window.addEventListener("app-navigate",(({detail:e})=>{t.l(e)}));const s=new WebAssembly.Memory({initial:5}),n=new Uint8Array(s.buffer),a=new e(n),i=await fetch("app-module.wasm",{headers:{Accept:"application/wasm"}}),r=await WebAssembly.instantiateStreaming(i,{env:{memory:s,...a.imports}});console.log(r),t.m=async function(){const t=Date.now();try{let t=await p.state;console.log("Backend state",t)}catch(t){const{errorCode:e}=t;if(401==e||403==e){const t=await p.authentify({password:"kostas",userName:"justin"});console.log(t)}console.log(t)}r.instance.exports.accept.bind(r.instance.exports)(),document.body.innerHTML="<p>No content for now</p>";const e=Date.now();console.log("JS perspective, took",e-t)},window.dispatchEvent(new CustomEvent("app-navigate",{detail:{url:"calendar",parameters:{}}}))}))})()})();