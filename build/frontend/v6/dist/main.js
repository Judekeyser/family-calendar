(()=>{var t={534:()=>{customElements.define("app-form-balancer",class extends HTMLElement{constructor(){super()}connectedCallback(){if(this.isConnected){let t,e,s;{const s=this.getAttribute("data-source-bind"),n=s.substring(0,s.indexOf(":"));e=s.substring(1+n.length),t="^"==n?this.parentElement:this.parentElement.querySelector(`*[data-id=${n}]`)}{const t=this.getAttribute("data-sink-element");s="^"==t?this.parentElement:this.parentElement.querySelector(`*[data-id=${t}]`)}t.addEventListener(e,(t=>{let e;t.preventDefault(),e=t instanceof FormDataEvent?t.formData:t.detail.formData;for(const[t,n]of e.entries())s[t].value=String(n);s.dispatchEvent(new Event("submit"))}))}}})},877:()=>{customElements.define("app-form-value-to-data",class extends HTMLElement{constructor(){super()}connectedCallback(){if(this.isConnected){const t=t=>{const e=new FormDataEvent("formdata",{formData:t});this.dispatchEvent(e)},e=this.getAttribute("data-on")||"change",s=this.firstElementChild;if("INPUT"===s.tagName.toUpperCase())s.addEventListener(e,(function(){const e=new FormData;e.set(this.name,String(this.value)),t(e)}))}}})},141:()=>{customElements.define("app-hyperlink-trait",class extends HTMLFormElement{constructor(){super()}connectedCallback(){if(this.isConnected){this.style.display="none";const t=this.getAttribute("data-bind");if(t){const e=t.substring(0,t.indexOf(":")),s=t.substring(1+e.length);("^"==e?this.parentElement:this.parentElement.querySelector(`*[data-id=${e}]`)).addEventListener(s,(()=>this.dispatchEvent(new Event("submit"))))}this.addEventListener("submit",(t=>{t.preventDefault(),this.t()}))}}t(){const t=this.getAttribute("action"),e=new FormData(this),s={url:t,parameters:Object.fromEntries(e)};console.log(">>>",t,[...e],s),window.dispatchEvent(new CustomEvent("app-navigate",{detail:s}))}},{extends:"form"})},382:()=>{customElements.define("app-unsafe-text",class extends HTMLElement{constructor(){super()}connectedCallback(){const t="data-text";if(this.isConnected){let e="[Une erreur est survenue]";try{e=atob(this.getAttribute(t))}catch(t){console.error(t)}this.textContent=e,this.removeAttribute(t)}}})}},e={};function s(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,s),i.exports}(()=>{"use strict";s(141),s(534),s(877),s(382);const t=/^20[0-9][0-9]$/,e=/^(0[1-9]|1[0-2])$/,n=/^([0-2][0-9]|3[0-1])$/,r=/^([0-1][0-9]|2[0-4])$/,i=/^[0-5][0-9]$/;function o(s){t:{if("string"!=typeof s)break t;const r=s.substring(0,4),i=s.substring(5,7),o=s.substring(8,10);if(r.match(t)&&(i.match(e)&&o.match(n))){if("31"==o)switch(i){case"02":case"04":case"06":case"09":case"11":break t}else{if(o>="29"&&"02"==i)break t;if("29"==o&&"02"==i)e:switch(r[2]){case"0":case"2":case"4":case"6":case"8":switch(r[3]){case"0":case"4":case"8":break e;default:break t}default:switch(r[3]){case"2":case"6":break e;default:break t}}}return[r,i,o].join("-")}}return null}function a(t){t:if("string"==typeof t)switch(t){case"fullday":case"morning":case"afternoon":return t;default:{const e=t.substring(0,2),s=t.substring(3,5);if(!e.match(r))break t;if(!s.match(i))break t;return[e,s].join(":")}}return null}function c(t){const{date:e,time:s}=t;return`${e} ${s}`}function u(t,e,s){const{kind:n,userInitiator:r}=t;if("cursor_move"===n){const{cursor:e}=t;return r&&r===s?({patchCursor:t})=>t(parseInt(String(e))):void 0}{const i=o(t.strDate),c=a(t.strTime);if(i&&c){if("create"===n){const{strDescription:n,strDetails:o,isDayOff:a}=t;if(n){const t=r&&r!==s&&e||0;return({createEvent:e})=>e({date:i,time:c},{description:n,details:o||void 0,isDayOff:a||!1,hitTime:t})}return}return"cancel"===n?({deleteEvent:t})=>t({date:i,time:c}):void 0}return}}function h(t,e,s){if(t){const{version:n}=t;switch(n){case 1:return u(t,e,s);case 2:return function(t,e,s){const{toCancel:n,toCreate:r}=t,i=u(n,e,s),o=u(r,e,s);return i&&o?t=>{i(t),o(t)}:void 0}(t,e,s)}}}async function d(t){const{from:e,password:s,newEvent:n}=t,r="/send_event.php?from="+String(e),i=window.__csrfToken,o={Accept:"application/json"};let a;if(i&&(o["X-Csrf-Token"]=i),s&&(o.Authentication=btoa(s)),n?(o["Content-Type"]="application/json",a=await fetch(r,{method:"POST",headers:o,body:JSON.stringify(n)})):a=await fetch(r,{method:"GET",headers:o}),200!==a.status){const t=a.headers.get("X-Authentication-Delay");throw{errorCode:a.status,authenticationDelay:t,errorMessage:await a.json()}}return a}async function l(t,e){function s(t){if(t){const s=window.localStorage.getItem("userName"),n=[];for(const e of t)if(e){const[t,r]=e;if(r){const e=h(t,r,s||void 0);e&&n.push(e)}}for(const t of n)t(e)}}const n=await d(t);return()=>async function(t){let e;for(let n=t;;){const t=parseInt(n.headers.get("x-next-page-time")||"0");if(!t||!isFinite(t)){s(await n.json());break}e=t,[n]=await Promise.all([d({from:t,password:void 0,newEvent:void 0}),n.json().then(s)])}return e}(n)}const f=new class{constructor(){this.view=new Map,this.newEvents=[],this.userCursor=0,this.isBusy=!1,this.lastUpdateTimestamp=0}#t(){if(!this.authentifiedUser.userName)throw{errorMessage:"Utilisateur non identifiÃ©",errorCode:403};return{view:this.view,newEvents:[...new Set(this.newEvents.map(c))].map((t=>{const{date:e,time:s}=function(t){const e=t.substring(0,t.indexOf(" ")),s=t.substring(e.length+1);return{date:o(e),time:a(s)}}(t);return{strDate:e,strTime:s}}))}}#e(t){const{date:e,time:s}=t,n=this.view.get(e);n&&(n.delete(s),n.size||this.view.delete(e))}#s(t,e){const{date:s,time:n}=t,{description:r,details:i,hitTime:o,isDayOff:a}=e,c={description:r,details:i,isDayOff:a,unread:!!(o&&o>this.userCursor)};this.view.set(s,(this.view.get(s)||new Map).set(n,c)),c.unread&&this.newEvents.push({hitTime:o,time:n,date:s})}#n(t){const e=[];for(const s of this.newEvents){const{date:n,time:r}=s,i=new Map(this.view.get(n)).get(r);i&&(t(s)?i.unread=!1:e.push(s))}this.newEvents=e}#r(t){if(!isNaN(t)){const e=Math.max(this.userCursor,t);this.#n((({hitTime:t})=>(t||-1)<=e))}}async#i(t){const{password:e,newEvent:s}=t;try{if(this.isBusy)return!1;this.isBusy=!0;try{const t=await l({password:e,newEvent:s,from:this.userCursor},{patchCursor:this.#r.bind(this),deleteEvent:this.#e.bind(this),createEvent:this.#s.bind(this)}),n=await t();this.userCursor=n||this.userCursor;const r=function(){const t=new Date(Date.now()).toLocaleDateString("fr-BE"),[e,s,n]=t.split("/");return[n,s,e].join("-")}();return this.#n((({date:t})=>(t||"")<r)),!0}finally{this.isBusy=!1}}catch(t){throw console.error(t),t}}get state(){return new Promise(((t,e)=>{const s=Date.now();(async()=>{if(!this.i||this.i<s-3e4)try{await this.#i({password:void 0,newEvent:void 0}),this.i=s}catch(t){e(t)}try{t(this.#t())}catch(t){e(t)}})()}))}get authentifiedUser(){return{userName:localStorage.getItem("userName")||void 0}}authentify=async t=>{const{password:e,userName:s}=t;return s?localStorage.setItem("userName",s):localStorage.removeItem("userName"),this.#i({password:e,newEvent:void 0})};createEvent=async t=>{const{time:e,date:s,strDescription:n,strDetails:r,isDayOff:i}=t,o={strTime:e,strDate:s,strDescription:n,strDetails:r,isDayOff:i,userInitiator:window.localStorage.getItem("userName")||void 0,kind:"create",version:1};return this.#i({newEvent:o,password:void 0})};cancelEvent=async t=>{const{date:e,time:s}=t,n={strDate:e,strTime:s,userInitiator:window.localStorage.getItem("userName")||void 0,version:1,kind:"cancel"};return this.#i({newEvent:n,password:void 0})};editEvent=async t=>{const{toCancel:e,toCreate:s}=t,n=window.localStorage.getItem("userName")||void 0,r={toCreate:(({date:t,time:e,strDescription:s,strDetails:r,isDayOff:i})=>({strTime:e,strDate:t,strDescription:s,strDetails:r,isDayOff:i,userInitiator:n,version:1,kind:"create"}))(s),toCancel:(({date:t,time:e})=>({strTime:e,strDate:t,version:1,kind:"cancel",userInitiator:n}))(e),version:2};return this.#i({newEvent:r,password:void 0})};markRead=async()=>{const t={userInitiator:window.localStorage.getItem("userName")||void 0,kind:"cursor_move",version:1,cursor:this.userCursor};return this.#i({newEvent:t,password:void 0})}};window.__backend__=f;class w{constructor(){this.o={},console.log(this)}async prepare_view(){let t,e;console.log("Computing Calendar view");try{t=await f.state}catch(t){console.error(t);const{errorCode:s,errorMessage:n}=t;e=401==s||403==s?{errorCode:s,errorMessage:n}:{errorCode:500,errorMessage:"Erreur inconnue"}}return this.o={success:t,failure:e,dependentObjects:new Map},t?1:0}get_times(t){try{const e=this.o.success.get(t),s={sequence:e?[...e.keys()]:[],data:e,cursor:0,next:function(){return this.cursor<this.data.length?(s.cursor+=1,1):0}};return this.registerObject(s)}catch(t){return console.error(t),0}}registerObject(t){const e=this.o.dependentObjects;for(let s=1;s<500;s++)if(!e.has(s))return e.set(s,t),s;throw"Unable to set more than 500 objects in memory"}}const m=new TextDecoder;const p=new TextEncoder;class v{constructor(t,e){this.u=t,this.h=e,this.l=void 0,this.m=void 0,this.o=new w}app_throw_error(t){const e=this.jsStringFromPointer(t);throw new WebAssembly.RuntimeError(e)}app_log(t){try{const e=this.jsStringFromPointer(t);console.log(e)}catch(t){console.error(t)}}app_get_env(t,e,s){try{const n=this.jsStringFromPointer(t),r=(()=>{switch(n){case"url":return window.location.hash.substring(1);case"today":{const t=new Date(Date.now()).toLocaleDateString("fr-BE"),[e,s,n]=t.split("/");return[n,s,e].join("-")}case"userName":return window.localStorage.getItem("userName");case"weeksCount":case"focusDate":return window.sessionStorage.getItem(n)}})()||"";this.writeJsStringToPointer(r,e,s)}catch(t){console.error(t),this.writeJsStringToPointer("",e,s)}}app_set_env(t,e){try{const s=this.jsStringFromPointer(t),n=this.jsStringFromPointer(e);switch(s){case"url":console.log("Trying to set URL",n);break;case"userName":console.log("Trying to set user name",n);break;case"focusDate":console.log("Trying to set focus date",n);break;case"weeksCount":console.log("Trying to set weeks count",n);break;default:console.warn("Cannot set read-only or non existing environment variable",s)}}catch(t){console.error(t)}}set resume(t){this.l=t}get resume(){return this.l}set enter(t){this.m=t}get enter(){return this.m}writeJsStringToPointer(t,e,s){!function(t,e){if(null!=t){const s=p.encode(t),n=s.byteLength+1;if(e.byteLength>=n)return e.set(s),e[s.byteLength]=0,n}}(t,this.u.subarray(e,e+s))}jsStringFromPointer(t){return function(t){let e=0;for(const s of t)if(e+=1,!s)break;const s=t.subarray(0,e-1);return m.decode(s)}(this.u.subarray(t))}get imports(){return Object.freeze(Object.fromEntries(["app_throw_error","app_log","app_get_env","app_set_env"].map((t=>[t,this[t].bind(this)]))))}}window.addEventListener("popstate",(t=>{!function({url:t}){const e=t||location.hash.substring(1)||"";window.dispatchEvent(new CustomEvent("app-navigate",{detail:{url:e}}))}({url:t.state})}));const y={p:async function({url:t}){try{!function({url:t}){const e=history.state,s=`#${t}`;e&&e==t?history.replaceState(t,"",s):history.pushState(t,"",s)}({url:t}),await this.v()}catch(t){console.error(t)}},v:void 0};window.addEventListener("load",(async()=>{const t=Object.setPrototypeOf({},y);window.addEventListener("app-navigate",(({detail:e})=>{t.p(e)}));const e=await async function(){const t=new WebAssembly.Memory({initial:5}),e=new Uint8Array(t.buffer),s=new v(e),n=await fetch("app-module.wasm",{headers:{Accept:"application/wasm"}}),r=await WebAssembly.instantiateStreaming(n,{env:{memory:t,...s.imports}}),i=r.instance.exports.accept.bind(r.instance.exports),o=r.instance.exports.resume.bind(r.instance.exports);return s.resume=o,s.enter=i,s}();t.v=async function(){const t=Date.now();e.enter(),document.body.innerHTML="<p>No content for now</p>";const s=Date.now();console.log("JS perspective, took",s-t)},window.dispatchEvent(new CustomEvent("app-navigate",{detail:{url:""}}))}))})()})();